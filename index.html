<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" href="/arx_favicon.png">
    <link rel="shortcut icon" type="image/png" href="/arx_favicon.png">
    <title>Business Sales Readiness Assessment | ARX Business Brokers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Google Analytics 4 -->
    <!-- Cache refresh -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
    
    <!-- Facebook Pixel -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', 'YOUR_PIXEL_ID');
        fbq('track', 'PageView');
    </script>
    
    <style>
        :root {
            --arx-navy: #0f172a;
            --arx-blue: #1e293b;
            --arx-orange: #ea580c;
            --arx-light: #f8fafc;
            --arx-gray: #64748b;
        }
        body {
            font-family: 'Open Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Inter', sans-serif;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-primary {
            background: linear-gradient(135deg, #ea580c, #dc2626);
            transition: all 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(234, 88, 12, 0.3);
        }
        .logo-text {
            font-family: 'Inter', 'Arial Black', sans-serif;
            font-weight: 900;
            letter-spacing: -0.05em;
        }
        /* Prevent sticky focus states on mobile */
        .answer-btn:focus {
            outline: none;
        }
        .answer-btn:active {
            transform: scale(0.98);
        }
        @media (hover: hover) {
            /* Only apply hover styles on devices that support hover */
            .answer-btn:hover {
                border-color: currentColor;
            }
        }
        /* Remove tap highlight on mobile */
        button {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen" tabindex="-1">
    <!-- Header -->
    <header class="bg-slate-900 text-white sticky top-0 z-50 shadow-lg">
        <div class="container max-w-6xl mx-auto px-4">
            <div class="flex items-center justify-between h-20 sm:h-16">
                <div class="flex items-center py-2">
                    <img src="/logo-white.png" alt="ARX Business Brokers" class="h-10 sm:h-8 w-auto" 
                         onerror="this.style.display='none'; document.getElementById('fallbackLogo').style.display='block';">
                    <!-- Fallback text logo if image fails -->
                    <div id="fallbackLogo" style="display:none;" class="logo-text text-3xl sm:text-4xl text-white lowercase">arx</div>
                </div>
                <div class="text-right">
                    <div class="text-xs uppercase tracking-wider opacity-75 hidden sm:block">Business</div>
                    <div class="text-sm sm:text-base font-semibold uppercase tracking-wide">Sales Readiness Score</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="bg-gray-200 h-2">
        <div id="progressBar" class="progress-bar bg-orange-600 h-full" style="width: 0%"></div>
    </div>

    <!-- Main Container -->
    <div class="max-w-3xl mx-auto px-4 pb-8 min-h-screen">
        
        <!-- Welcome Screen -->
        <div id="welcome" class="question-screen fade-in">
            <div class="bg-white rounded-xl shadow-xl p-8 sm:p-10 mt-8 max-w-2xl mx-auto">
                <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 mb-4">
                    Is Your Business Ready to Sell?
                </h1>
                <p class="text-base sm:text-lg text-gray-700 mb-6 leading-relaxed">
                    Discover your business's true market position with our comprehensive 26-point assessment. 
                    Get an instant score and personalized recommendations in under 3 minutes.
                </p>
                <div class="space-y-4 mb-8">
                    <div class="flex items-start">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-500 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-gray-700 text-sm sm:text-base">26 strategic questions across 6 critical areas</span>
                    </div>
                    <div class="flex items-start">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-500 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-gray-700 text-sm sm:text-base">Instant score with market-based valuation insights</span>
                    </div>
                    <div class="flex items-start">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-500 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-gray-700 text-sm sm:text-base">Personalized improvement recommendations</span>
                    </div>
                </div>
                
                <!-- Industry Selection -->
                <div class="mb-6">
                    <label class="block text-sm sm:text-base font-medium text-gray-700 mb-2">What industry is your business in? *</label>
                    <select id="industry" name="industry" required class="w-full p-3 sm:p-4 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white">
                        <option value="">Select your industry</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Construction">Construction</option>
                        <option value="Retail">Retail</option>
                        <option value="Food & Beverage">Food & Beverage</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Professional Services">Professional Services</option>
                        <option value="Technology">Technology</option>
                        <option value="Transportation & Logistics">Transportation & Logistics</option>
                        <option value="Real Estate">Real Estate</option>
                        <option value="Financial Services">Financial Services</option>
                        <option value="Education">Education</option>
                        <option value="Automotive">Automotive</option>
                        <option value="Agriculture">Agriculture</option>
                        <option value="Energy">Energy</option>
                        <option value="Entertainment & Media">Entertainment & Media</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <button onclick="startAssessment()" class="btn-primary w-full py-4 px-6 rounded-xl text-white font-semibold text-base sm:text-lg shadow-lg">
                    Start Assessment →
                </button>
                <p class="text-xs sm:text-sm text-gray-500 mt-4 text-center">
                    No payment required • 100% confidential
                </p>
            </div>
        </div>

        <!-- Question Template (Hidden, will be cloned) -->
        <div id="questionTemplate" class="question-screen hidden">
            <div class="bg-white rounded-xl shadow-xl p-6 sm:p-8 mt-8 fade-in max-w-2xl mx-auto">
                <div class="mb-6">
                    <span class="text-xs sm:text-sm text-orange-600 font-bold uppercase tracking-wider category-label">Category</span>
                    <div class="text-sm text-gray-500 mt-1">
                        Question <span class="current-q">1</span> of <span class="total-q">26</span>
                    </div>
                </div>
                <h2 class="text-lg sm:text-xl font-semibold text-slate-900 mb-8 leading-relaxed question-text">
                    Question goes here?
                </h2>
                <div class="space-y-3">
                    <button onclick="answerQuestion(true, event)" class="answer-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 transition-all group">
                        <div class="flex items-center pointer-events-none">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-green-100 group-hover:bg-green-200 flex items-center justify-center mr-4 flex-shrink-0 transition-colors">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900 text-base">Yes</div>
                                <div class="text-sm text-gray-600 yes-description">Positive indicator</div>
                            </div>
                        </div>
                    </button>
                    <button onclick="answerQuestion(false, event)" class="answer-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-red-500 hover:bg-red-50 transition-all group">
                        <div class="flex items-center pointer-events-none">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-red-100 group-hover:bg-red-200 flex items-center justify-center mr-4 flex-shrink-0 transition-colors">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900 text-base">No</div>
                                <div class="text-sm text-gray-600 no-description">Area for improvement</div>
                            </div>
                        </div>
                    </button>
                    <button onclick="answerQuestion(null, event)" class="answer-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-all group">
                        <div class="flex items-center pointer-events-none">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gray-100 group-hover:bg-gray-200 flex items-center justify-center mr-4 flex-shrink-0 transition-colors">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900 text-base">Not Sure / Not Applicable</div>
                                <div class="text-sm text-gray-600">Skip this question</div>
                            </div>
                        </div>
                    </button>
                </div>
                <button onclick="goBack()" class="mt-6 text-gray-500 hover:text-gray-700 text-sm flex items-center transition-colors">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back
                </button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8 mt-8 fade-in">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Your Sales Readiness Score</h2>
                <div class="text-6xl font-bold text-orange-600 my-8">
                    <span id="scoreValue">0</span>%
                </div>
                <div id="scoreInterpretation" class="text-lg text-gray-700 mb-4"></div>
                
                <div class="bg-gray-50 rounded-lg p-6 mb-6">
                    <h3 class="text-xl font-semibold text-slate-900 mb-3">Get Your Complete Analysis</h3>
                    <p class="text-gray-700 mb-4">Your personalized report will include:</p>
                    <ul class="space-y-2 text-gray-700 mb-4">
                        <li class="flex items-start">
                            <svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span>Detailed breakdown of each assessment category with specific scores</span>
                        </li>
                        <li class="flex items-start">
                            <svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span>Industry-specific benchmarks and insights for your business sector</span>
                        </li>
                        <li class="flex items-start">
                            <svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span>Priority action plan to address your biggest opportunities</span>
                        </li>
                        <li class="flex items-start">
                            <svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span>Estimated timeline and investment required for improvements</span>
                        </li>
                        <li class="flex items-start">
                            <svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span>Potential valuation impact of implementing our recommendations</span>
                        </li>
                    </ul>
                </div>
                
                <button onclick="showDetailedReport()" class="btn-primary w-full py-4 px-6 rounded-lg text-white font-semibold text-lg">
                    Get My Complete Analysis →
                </button>
                <p class="text-sm text-gray-500 mt-3 text-center">
                    Prepared by experienced M&A professionals • Delivered within 1 business day
                </p>
            </div>
        </div>

        <!-- Lead Capture Form -->
        <div id="leadCapture" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8 mt-8 fade-in">
                <h2 class="text-2xl font-bold text-slate-900 mb-2">Get Your Personalized Report</h2>
                <p class="text-gray-600 mb-6">
                    We'll send you a detailed analysis with specific recommendations to improve your business's sale readiness.
                </p>
                <form id="leadForm" onsubmit="submitLeadForm(event)">
                    <input type="text" id="honeypot" name="honeypot" style="position:absolute;left:-9999px;opacity:0;height:0;width:0;border:0;padding:0;margin:0;pointer-events:none" tabindex="-1" autocomplete="new-password" aria-hidden="true" readonly>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                            <input type="text" name="name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" name="email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                            <input type="tel" name="phone" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Company Name *</label>
                            <input type="text" name="company" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Company Website</label>
                            <input type="text" name="website" placeholder="yourcompany.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Business Location (Zip Code) *</label>
                            <input type="text" name="zipcode" required pattern="[0-9]{5}" placeholder="12345" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                    <button type="submit" class="btn-primary w-full py-4 px-6 rounded-lg text-white font-semibold text-lg mt-6">
                        Get My Report →
                    </button>
                    <p class="text-xs text-gray-500 mt-4 text-center">
                        Your information is 100% confidential and will never be shared.
                    </p>
                </form>
            </div>
        </div>

        <!-- Thank You Screen -->
        <div id="thankYou" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8 mt-8 fade-in text-center">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-slate-900 mb-4">Your Report is Being Prepared</h2>
                <p class="text-lg text-gray-700 mb-6">
                    Thank you for completing the assessment! Your personalized analysis is now being reviewed by one of our experienced M&A professionals.
                </p>
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6">
                    <h3 class="font-semibold text-orange-800 mb-2">What happens next:</h3>
                    <ul class="text-left text-orange-700 space-y-1">
                        <li>• Our team reviews your responses and industry context</li>
                        <li>• We prepare your customized recommendations</li>
                        <li>• Your complete report arrives in your inbox within 1 business day</li>
                    </ul>
                </div>
                <p class="text-gray-600 mb-4">
                    <strong>Can't wait?</strong> One of our senior advisors may reach out to discuss your preliminary results and answer any immediate questions about your business sale preparation.
                </p>
                <p class="text-sm text-gray-500">
                    Check your email (including spam folder) for your detailed analysis report.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Assessment Data
        const categories = [
            {
                name: "Transferability Risk",
                weight: 0.30,
                questions: [
                    {
                        text: "Does the business operate without requiring the owner's unique skills or knowledge?",
                        weight: 0.35,
                        yesText: "Business runs on systems",
                        noText: "Owner is the business"
                    },
                    {
                        text: "Are key customer relationships maintained by at least two non-owner employees?",
                        weight: 0.20,
                        yesText: "Relationships are institutional",
                        noText: "Owner holds relationships"
                    },
                    {
                        text: "Would the business survive losing any single employee (including the owner)?",
                        weight: 0.15,
                        yesText: "No single point of failure",
                        noText: "Dangerous dependencies"
                    },
                    {
                        text: "Is the owner working less than 25 hours per week in the business?",
                        weight: 0.10,
                        yesText: "Business runs itself",
                        noText: "Owner is overinvolved"
                    },
                    {
                        text: "Are all critical processes documented in writing?",
                        weight: 0.10,
                        yesText: "Trainable systems",
                        noText: "Tribal knowledge"
                    },
                    {
                        text: "Could the business operate profitably with an absentee owner for 60+ days?",
                        weight: 0.10,
                        yesText: "True business",
                        noText: "Glorified job"
                    }
                ]
            },
            {
                name: "Growth Track Record",
                weight: 0.20,
                questions: [
                    {
                        text: "Did the company grow revenue year-over-year in the most recent 12 months?",
                        weight: 0.40,
                        yesText: "Growing now",
                        noText: "Stagnant or declining"
                    },
                    {
                        text: "Did revenue increase in at least 4 of the last 5 years?",
                        weight: 0.25,
                        yesText: "Proven growth",
                        noText: "Sporadic performance"
                    },
                    {
                        text: "Do you feel your business has grown faster than most of your competitors?",
                        weight: 0.20,
                        yesText: "Taking share",
                        noText: "Losing ground"
                    },
                    {
                        text: "Do you regularly attract new customers to replace any you might lose?",
                        weight: 0.15,
                        yesText: "Healthy new business",
                        noText: "Aging customer base"
                    }
                ]
            },
            {
                name: "Market Dynamics",
                weight: 0.15,
                questions: [
                    {
                        text: "Is demand for your products/services generally increasing each year?",
                        weight: 0.40,
                        yesText: "Growth industry",
                        noText: "Stagnant/declining"
                    },
                    {
                        text: "Would it take a new competitor more than $100k to start competing with you?",
                        weight: 0.30,
                        yesText: "Protected",
                        noText: "Easy entry"
                    },
                    {
                        text: "Would it be difficult for someone to replace your service with a computer or app?",
                        weight: 0.30,
                        yesText: "Disruption resistant",
                        noText: "Vulnerable"
                    }
                ]
            },
            {
                name: "Business Model Attractiveness",
                weight: 0.15,
                questions: [
                    {
                        text: "Is your revenue predictable through contracts, subscriptions, or repeat customers?",
                        weight: 0.35,
                        yesText: "Stable revenue",
                        noText: "Unpredictable"
                    },
                    {
                        text: "After paying all expenses, do you typically keep more than 15 cents of every dollar in revenue?",
                        weight: 0.25,
                        yesText: "Healthy margins",
                        noText: "Thin margins"
                    },
                    {
                        text: "Did the business revenue drop less than 15% during 2008 or 2020?",
                        weight: 0.20,
                        yesText: "Recession resistant",
                        noText: "Cyclical"
                    },
                    {
                        text: "Is your equipment investment less than 50% of annual revenue?",
                        weight: 0.20,
                        yesText: "Asset light",
                        noText: "Capital intensive"
                    }
                ]
            },
            {
                name: "Financial Integrity & Operations",
                weight: 0.10,
                questions: [
                    {
                        text: "Are your financial records clean and prepared by a professional?",
                        weight: 0.30,
                        yesText: "Bankable",
                        noText: "Requires normalization"
                    },
                    {
                        text: "Does no single customer represent more than 15% of revenue?",
                        weight: 0.25,
                        yesText: "Diversified",
                        noText: "Concentration risk"
                    },
                    {
                        text: "Do you keep personal expenses separate from business expenses?",
                        weight: 0.20,
                        yesText: "Clean operations",
                        noText: "Lifestyle business"
                    },
                    {
                        text: "Has a CPA reviewed or prepared your financial statements?",
                        weight: 0.15,
                        yesText: "Verified",
                        noText: "Unverified"
                    },
                    {
                        text: "Do most of your customers come back year after year?",
                        weight: 0.10,
                        yesText: "Sticky customers",
                        noText: "High churn"
                    }
                ]
            },
            {
                name: "Competitive Moat",
                weight: 0.10,
                questions: [
                    {
                        text: "Do you have 4.0+ stars online OR can you provide 10+ positive customer references?",
                        weight: 0.30,
                        yesText: "Strong reputation",
                        noText: "Reputation issues"
                    },
                    {
                        text: "Do potential customers regularly contact you without you having to chase them?",
                        weight: 0.25,
                        yesText: "Strong marketing",
                        noText: "Weak presence"
                    },
                    {
                        text: "Can you charge 10%+ more than competitors and keep customers?",
                        weight: 0.25,
                        yesText: "Premium position",
                        noText: "Commodity"
                    },
                    {
                        text: "Have you won 5+ new accounts from competitors in the last 12 months?",
                        weight: 0.20,
                        yesText: "Winning",
                        noText: "Not competing"
                    }
                ]
            }
        ];

        // No hardcoded credentials - all API calls go through our secure Netlify function

        // State Management
        let currentCategoryIndex = 0;
        let currentQuestionIndex = 0;
        let answers = [];
        let totalQuestions = categories.reduce((sum, cat) => sum + cat.questions.length, 0);
        let currentQuestionNumber = 0;
        let assessmentStartTime = null;
        let businessInfo = {};

        // Safe analytics tracking
        function trackEvent(eventName, parameters) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, parameters);
            }
        }
        
        function trackFBEvent(eventName, parameters) {
            if (typeof fbq !== 'undefined') {
                fbq('track', eventName, parameters);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Track page view
            trackEvent('page_view', {
                page_title: 'Sales Readiness Assessment',
                page_location: window.location.href
            });
        });

        function startAssessment() {
            // Validate industry selection
            const industry = document.getElementById('industry').value;
            
            if (!industry) {
                alert('Please select your industry before starting the assessment.');
                return;
            }
            
            // Store business information
            businessInfo = {
                industry: industry,
                website: null // Will be set from lead form
            };
            
            document.getElementById('welcome').classList.add('hidden');
            assessmentStartTime = Date.now(); // Track start time for spam protection
            showQuestion();
            trackEvent('begin_checkout', {
                value: 0,
                currency: 'USD',
                items: [{
                    item_name: 'Sales Readiness Assessment',
                    item_category: 'Lead Generation'
                }]
            });
        }

        function showQuestion() {
            const category = categories[currentCategoryIndex];
            const question = category.questions[currentQuestionIndex];
            currentQuestionNumber = getCurrentQuestionNumber();
            
            console.log('Showing question:', currentQuestionNumber, 'of', totalQuestions);
            
            // Hide all screens
            document.querySelectorAll('.question-screen').forEach(el => el.classList.add('hidden'));
            document.getElementById('results').classList.add('hidden');
            document.getElementById('leadCapture').classList.add('hidden');
            document.getElementById('thankYou').classList.add('hidden');
            
            // Remove any existing question display
            const existing = document.getElementById('currentQuestion');
            if (existing) {
                existing.remove();
            }
            
            // Clone template and prepare new question
            const template = document.getElementById('questionTemplate');
            const questionDiv = template.cloneNode(true);
            questionDiv.id = 'currentQuestion';
            questionDiv.classList.remove('hidden');
            questionDiv.classList.add('fade-in');
            
            // Update content
            questionDiv.querySelector('.category-label').textContent = category.name.toUpperCase();
            questionDiv.querySelector('.current-q').textContent = currentQuestionNumber;
            questionDiv.querySelector('.total-q').textContent = totalQuestions;
            questionDiv.querySelector('.question-text').textContent = question.text;
            questionDiv.querySelector('.yes-description').textContent = question.yesText;
            questionDiv.querySelector('.no-description').textContent = question.noText;
            
            // Add to DOM
            const container = document.querySelector('.max-w-3xl');
            if (!container) {
                console.error('Container not found! Looking for .max-w-3xl');
                return;
            }
            container.appendChild(questionDiv);
            
            // Update progress
            updateProgress();
            
            // Reset focus to prevent mobile highlight issue
            document.body.focus();
            
            // Scroll to top smoothly
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function getCurrentQuestionNumber() {
            let num = 0;
            for (let i = 0; i < currentCategoryIndex; i++) {
                num += categories[i].questions.length;
            }
            return num + currentQuestionIndex + 1;
        }

        function answerQuestion(answer, event) {
            // Prevent default and stop propagation
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // Remove focus from the clicked button (fixes mobile highlight issue)
            if (document.activeElement) {
                document.activeElement.blur();
            }
            
            // Store answer
            answers.push({
                category: currentCategoryIndex,
                question: currentQuestionIndex,
                answer: answer
            });
            
            // Track answer
            trackEvent('assessment_answer', {
                question_number: currentQuestionNumber,
                category: categories[currentCategoryIndex].name,
                answer: answer === true ? 'yes' : answer === false ? 'no' : 'skip'
            });
            
            // Move to next question
            currentQuestionIndex++;
            if (currentQuestionIndex >= categories[currentCategoryIndex].questions.length) {
                currentCategoryIndex++;
                currentQuestionIndex = 0;
            }
            
            if (currentCategoryIndex >= categories.length) {
                calculateResults();
            } else {
                // Small delay to ensure blur completes before showing next question
                setTimeout(() => {
                    showQuestion();
                }, 50);
            }
        }

        function goBack() {
            if (answers.length > 0) {
                // Remove last answer
                answers.pop();
                
                // Move back one question
                currentQuestionIndex--;
                if (currentQuestionIndex < 0) {
                    currentCategoryIndex--;
                    if (currentCategoryIndex >= 0) {
                        currentQuestionIndex = categories[currentCategoryIndex].questions.length - 1;
                    }
                }
                
                // Check if we're back at the beginning
                if (currentCategoryIndex < 0) {
                    // Reset to beginning
                    currentCategoryIndex = 0;
                    currentQuestionIndex = 0;
                    
                    // Hide current question and show welcome
                    const currentQuestion = document.getElementById('currentQuestion');
                    if (currentQuestion) {
                        currentQuestion.remove();
                    }
                    document.getElementById('welcome').classList.remove('hidden');
                    
                    // Reset progress bar
                    document.getElementById('progressBar').style.width = '0%';
                } else {
                    // Show previous question
                    showQuestion();
                }
            } else {
                // No answers yet, ensure we're on welcome screen
                const currentQuestion = document.getElementById('currentQuestion');
                if (currentQuestion) {
                    currentQuestion.remove();
                }
                document.getElementById('welcome').classList.remove('hidden');
                document.getElementById('progressBar').style.width = '0%';
            }
        }

        function updateProgress() {
            const progress = (currentQuestionNumber / totalQuestions) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function calculateResults() {
            let totalScore = 0;
            
            categories.forEach((category, catIndex) => {
                let categoryScore = 0;
                category.questions.forEach((question, qIndex) => {
                    const answer = answers.find(a => 
                        a.category === catIndex && a.question === qIndex
                    );
                    if (answer && answer.answer === true) {
                        categoryScore += question.weight;
                    }
                });
                totalScore += categoryScore * category.weight;
            });
            
            const finalScore = Math.round(totalScore * 100);
            showResults(finalScore);
        }

        function showResults(score) {
            // Hide current question if exists
            const currentQuestion = document.getElementById('currentQuestion');
            if (currentQuestion) {
                currentQuestion.classList.add('hidden');
            }
            
            // Show results
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('progressBar').style.width = '100%';
            
            // Animate score
            const scoreElement = document.getElementById('scoreValue');
            let displayScore = 0;
            const increment = score / 20;
            const timer = setInterval(() => {
                displayScore += increment;
                if (displayScore >= score) {
                    displayScore = score;
                    clearInterval(timer);
                }
                scoreElement.textContent = Math.round(displayScore);
            }, 50);
            
            let interpretation = '';
            if (score >= 80) {
                interpretation = "Excellent! Your business is in the top quartile for sale readiness. You're positioned for a premium valuation.";
            } else if (score >= 60) {
                interpretation = "Good position! Your business is above average in sale readiness, with some areas for improvement.";
            } else if (score >= 40) {
                interpretation = "Average readiness. There are significant opportunities to improve your business value before selling.";
            } else if (score >= 20) {
                interpretation = "Below average readiness. Consider implementing improvements before going to market.";
            } else {
                interpretation = "Your business needs significant improvements to be market-ready. Let's discuss a preparation strategy.";
            }
            
            document.getElementById('scoreInterpretation').textContent = interpretation;
            
            // Track completion
            trackEvent('assessment_complete', {
                score: score,
                score_category: score >= 80 ? 'premium' : score >= 60 ? 'above_average' : score >= 40 ? 'average' : score >= 20 ? 'below_average' : 'needs_improvement'
            });
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }


        function showDetailedReport() {
            document.getElementById('results').classList.add('hidden');
            document.getElementById('leadCapture').classList.remove('hidden');
            
            trackEvent('begin_lead_capture');
        }

        async function submitLeadForm(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const timeSpent = assessmentStartTime ? Math.floor((Date.now() - assessmentStartTime) / 1000) : 0;
            
            // Spam protection checks (temporarily disabled for testing)
            const honeypot = formData.get('honeypot');
            if (honeypot) {
                console.log('Honeypot filled (but allowing submission for testing):', honeypot);
                // return; // Silent fail for spam - DISABLED FOR TESTING
            }
            
            if (timeSpent < 30) {
                alert('Please take your time to complete the assessment properly.');
                return;
            }
            
            // Prepare data for Supabase
            const submissionData = {
                name: formData.get('name'),
                email: formData.get('email'),
                company: formData.get('company'),
                phone: formData.get('phone'),
                industry: businessInfo.industry,
                website: formData.get('website') || null,
                zipcode: formData.get('zipcode'),
                score: parseInt(document.getElementById('scoreValue').textContent),
                responses: answers,
                time_spent: timeSpent,
                user_agent: navigator.userAgent,
                referrer: document.referrer,
                ip_address: null // Will be set by server if needed
            };
            
            try {
                // Submit to our secure Netlify function
                const response = await fetch('/.netlify/functions/process-assessment-final', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(submissionData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Assessment submitted and processed successfully:', result);
                
                // Track conversion
                trackEvent('generate_lead', {
                    currency: 'USD',
                    value: 100
                });
                
                trackFBEvent('Lead', {
                    currency: 'USD',
                    value: 100
                });
                
                // Show thank you
                document.getElementById('leadCapture').classList.add('hidden');
                document.getElementById('thankYou').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error submitting lead:', error);
                alert('There was an error submitting your information. Please try again or contact us directly.');
            }
        }
    </script>
</body>
</html>