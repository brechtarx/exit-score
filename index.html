<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Get your free Business Sale Readiness Score in 3 minutes. AI-powered assessment analyzes 6 key categories to determine how ready your business is for sale. Trusted by business owners nationwide.">
    <meta name="keywords" content="business sale readiness, business valuation, sell my business, business broker, exit planning, business assessment, M&A advisory">
    <meta name="author" content="ARX Business Brokers">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://score.arxbrokers.com/">
    
    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="Get Your Business Sale Readiness Score in 3 Minutes">
    <meta property="og:description" content="Free AI-powered assessment that analyzes your business across 6 key categories to determine sale readiness. Get personalized recommendations from M&A experts.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://score.arxbrokers.com/">
    <meta property="og:image" content="https://score.arxbrokers.com/arx_website_blueblack.webp">
    <meta property="og:site_name" content="ARX Business Brokers">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Get Your Business Sale Readiness Score in 3 Minutes">
    <meta name="twitter:description" content="Free AI-powered assessment that analyzes your business across 6 key categories to determine sale readiness.">
    <meta name="twitter:image" content="https://score.arxbrokers.com/arx_website_blueblack.webp">
    
    <!-- Favicons -->
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/assets/images/arx_favicon.png">
    <link rel="shortcut icon" type="image/png" href="/assets/images/arx_favicon.png">
    <link rel="apple-touch-icon" href="/assets/images/arx_favicon.png">
    
    <title>Exit Score - Know Your Business Sale Readiness in 3 Minutes | ARX Business Brokers</title>
    <link rel="stylesheet" href="/assets/css/tailwind.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "ARX Business Brokers",
        "url": "https://arxbrokers.com",
        "logo": "https://score.arxbrokers.com/arx_website_blueblack.webp",
        "sameAs": [
            "https://www.linkedin.com/company/arxbusinessbrokers"
        ]
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Business Sale Readiness Assessment",
        "description": "Free AI-powered assessment that analyzes your business across 6 key categories to determine sale readiness",
        "url": "https://score.arxbrokers.com/",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "publisher": {
            "@type": "Organization",
            "name": "ARX Business Brokers"
        }
    }
    </script>

    <!-- reCAPTCHA removed temporarily per request (no spam gate) -->
    
    <!-- GA4 (direct) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-23SV7KW5WM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);} 
      gtag('js', new Date());
      gtag('config', 'G-23SV7KW5WM');
    </script>

    <!-- Meta/LinkedIn IDs (direct) -->
    <script>
      window.META_PIXEL_ID = '690707790141192';
      window.LINKEDIN_PARTNER_ID = '7910892';
    </script>

    <!-- Meta Pixel + LinkedIn Insight (conditional) -->
    <script>
      (function(){
        if (window.META_PIXEL_ID) {
          !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
          n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
          n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
          t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script',
          'https://connect.facebook.net/en_US/fbevents.js');
          fbq('init', window.META_PIXEL_ID);
          fbq('track', 'PageView');
        }
        if (window.LINKEDIN_PARTNER_ID) {
          window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
          window._linkedin_data_partner_ids.push(window.LINKEDIN_PARTNER_ID);
          (function(){var s = document.getElementsByTagName('script')[0];
            var b = document.createElement('script'); b.type='text/javascript'; b.async=true;
            b.src='https://snap.licdn.com/li.lms-analytics/insight.min.js'; s.parentNode.insertBefore(b,s);})();
        }
      })();
    </script>

    <!-- Modular JS -->
    <script src="/assets/js/analytics.js"></script>
    <script src="/assets/js/questions.js"></script>
    
    
    <!-- Facebook Pixel disabled until proper ID is configured -->
    <!--
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', 'YOUR_PIXEL_ID');
        fbq('track', 'PageView');
    </script>
    -->
    
    <style>
        :root {
            /* ARX Brand Colors */
            --bright-white: #FAFAFA;
            --light-stone-white: #F0F1F2;
            --cool-gray: #B3B6B8;
            --hyperlink-blue: #416EA6;
            --dark-anchor: #101620;
            
            /* Legacy colors (to be phased out) */
            --arx-navy: #0f172a;
            --arx-blue: #1e293b;
            --arx-orange: #ea580c;
            --arx-light: #f8fafc;
            --arx-gray: #64748b;
        }
        body {
            font-family: 'Open Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Inter', sans-serif;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-primary {
            background: #000000;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background: #1a1a1a;
        }
        .logo-text {
            font-family: 'Inter', 'Arial Black', sans-serif;
            font-weight: 900;
            letter-spacing: -0.05em;
        }
        /* Removed outline: none to allow Tailwind focus styles to work */
        .answer-btn:active {
            transform: scale(0.98);
        }
        /* Removed hover override to allow Tailwind hover: classes to work properly */
        /* Brand utility classes */
        .bg-dark-anchor {
            background-color: var(--dark-anchor);
        }
        .bg-bright-white {
            background-color: var(--bright-white);
        }
        .bg-light-stone-white {
            background-color: var(--light-stone-white);
        }
        .text-cool-gray {
            color: var(--cool-gray);
        }
        .text-hyperlink-blue {
            color: var(--hyperlink-blue);
        }
        .text-dark-anchor {
            color: var(--dark-anchor);
        }
        .text-bright-white {
            color: var(--bright-white);
        }
        .bg-hyperlink-blue {
            background-color: var(--hyperlink-blue);
        }
        .font-headline {
            font-family: 'Inter', sans-serif;
        }
        .font-body {
            font-family: 'Open Sans', sans-serif;
        }
        
        /* Remove tap highlight on mobile */
        button {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Mobile-specific improvements for older users */
        @media (max-width: 640px) {
            /* Ensure minimum font sizes for readability */
            html {
                font-size: 18px; /* Increase base font size on mobile */
            }
            
            /* Improve button interactions */
            .btn-primary {
                min-height: 56px; /* Larger touch target */
            }
            
            /* Better spacing for mobile */
            .question-screen {
                padding: 0.5rem;
            }
            
            /* Dropdown improvements */
            select {
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
                background-position: right 1rem center;
                background-repeat: no-repeat;
                background-size: 1.5em 1.5em;
                padding-right: 3rem;
            }
        }

        /* Remove sticky hover states on touch devices */
        @media (hover: none) and (pointer: coarse) {
            .answer-btn:hover { background-color: transparent !important; border-color: #e5e7eb !important; }
        }
        
        /* Active button state */
        .active\:scale-98:active {
            transform: scale(0.98);
        }
        
        /* Loading spinner animation */
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .btn-loading {
            opacity: 0.8;
            cursor: not-allowed;
        }

        /* Error and success message styles */
        .error-message {
            background-color: #fee2e2;
            border: 1px solid #fca5a5;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            display: none;
        }
        
        .success-message {
            background-color: #d1fae5;
            border: 1px solid #6ee7b7;
            color: #065f46;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            display: none;
        }

        /* Subtle pressed feedback for answer buttons (JS adds .flash briefly) */
        .answer-btn.flash {
            border-color: #22c55e !important; /* green-500 */
            background-color: #ecfdf5 !important; /* green-50 */
            transition: background-color 150ms ease;
        }

        /* Safe-area padding for bottom UI */
        .question-screen { padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 24px) !important; }

        /* Hide overlay/global progress text */
        #progressText { display: none !important; }
        #progressLabel { display: none !important; }
        @media (max-width: 640px) { #progressText { display: none !important; } }

        /* Header padding */
        header .inner { min-height: 84px; padding: 10px 0; }
        /* Compact header when answering */
        header.compact .inner { min-height: 64px !important; padding: 6px 0 !important; }

        /* Print styles: show results in clean layout */
        @media print {
            @page { margin: 12mm 14mm; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; font-size: 12px; }
            header, .progress-bar, footer,
            #welcome, #revenueSelection, #employeeSelection, #zipcodeSelection,
            #leadCapture, #additionalDetails, #thankYou,
            .question-screen, .no-print { display: none !important; }
            /* Main content fills the page width */
            body > .max-w-3xl { max-width: 100% !important; width: 100% !important; padding: 0 !important; margin: 0 !important; }
            .min-h-screen { min-height: 0 !important; }
            /* Results container should be plain (no card UI) */
            #results { display: block !important; box-shadow: none !important; border: 0 !important; background: transparent !important; }
            #results > div { box-shadow: none !important; border: 0 !important; background: transparent !important; padding: 0 !important; }
            /* Tighter typography for one-page fit */
            #results h2 { margin: 0 0 6px 0 !important; font-size: 20px !important; }
            #results h3 { margin: 8px 0 6px 0 !important; font-size: 16px !important; }
            #results .text-6xl { font-size: 36px !important; line-height: 1.1 !important; }
            #results #scoreInterpretation { margin: 6px 0 10px 0 !important; }
            #categoryBreakdown > div { margin: 6px 0 !important; padding: 8px 10px !important; }
            /* No reCAPTCHA badge currently */
            /* Prominent ARX logo header */
            .print-letterhead { display: none !important; }
            .print-header { display: block !important; margin: 0 0 6mm 0; }
            .print-header img { height: 72px; }
            /* Print-only CTA */
            .print-cta { display: block !important; margin-top: 6mm; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen" tabindex="-1">
    <!-- Meta Pixel (noscript fallback) -->
    <noscript>
      <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=690707790141192&ev=PageView&noscript=1" />
    </noscript>
    <!-- LinkedIn Insight noscript fallback -->
    <noscript>
      <img height="1" width="1" style="display:none;" alt="" src="https://px.ads.linkedin.com/collect/?pid=7910892&fmt=gif" />
    </noscript>
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="container max-w-6xl mx-auto px-4">
            <div class="flex items-center justify-between inner">
                <div class="flex items-center">
                    <img src="/arx_website_blueblack.webp" alt="ARX Business Brokers" style="height: 50px; width: auto;" loading="eager" decoding="async" width="150" height="50" onerror="this.style.display='none'; document.getElementById('fallbackLogo').style.display='block';">
                    <div id="fallbackLogo" style="display:none;" class="logo-text text-2xl text-slate-900 lowercase font-bold">arx</div>
                </div>
                <div class="text-right">
                    <div class="text-sm font-medium text-slate-900">Business Sales Readiness Assessment</div>
                    <div class="text-xs text-slate-600">Free • Confidential • 3 minutes</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="bg-gray-200 h-3 relative">
        <div class="max-w-6xl mx-auto">
            <div id="progressBar" class="progress-bar bg-hyperlink-blue h-full transition-all duration-300" style="width: 0%"></div>
        </div>
        <!-- Progress Text (hidden on all screens now; we use in-card label) -->
        <div id="progressText" class="hidden" aria-live="polite"><span id="progressCounter">0 of 26</span></div>
    </div>

    <!-- Progress Dots (questions only) -->
    <div id="progressDotsWrap" class="w-full bg-white/0 hidden">
        <div id="progressDots" class="max-w-6xl mx-auto px-4 py-2 overflow-x-auto">
            <div id="progressDotsRow" class="flex items-center gap-1.5"></div>
        </div>
        <div id="progressLabel" class="max-w-6xl mx-auto px-4 text-xs text-gray-600 font-medium pb-1"></div>
    </div>

    <!-- Main Container -->
    <div class="max-w-3xl mx-auto px-2 sm:px-4 pb-8 min-h-screen">
        <!-- Print-only letterhead (first page) -->
        <div id="printLetterhead" class="print-letterhead hidden"></div>
        <!-- Print-only simple header (fallback if needed) -->
        <div id="printHeader" class="print-header hidden">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <div style="display:flex;align-items:center;gap:12px;">
                    <img src="/assets/images/arx_logo_Logo_basic_rich_black.png" alt="ARX">
                    <div style="font-weight:800;color:#101620;">Exit Score Report</div>
                </div>
                <div style="text-align:right;color:#6b7280;font-size:12px;">
                    ARX Business Brokers • sales@arxbrokers.com • (855) 858-2130
                </div>
            </div>
        </div>
        <!-- Print-only CTA -->
        <div id="printCTA" class="print-cta hidden">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
                <div style="font-size:14px;color:#111827;">
                    Book a free, accurate business valuation:
                </div>
                <div>
                    <a href="https://arxbrokers.com/appointments" style="font-weight:700;text-decoration:none;color:#416EA6;">
                        arxbrokers.com/appointments
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Welcome Screen -->
        <div id="welcome" class="question-screen fade-in">
            <div class="sm:bg-white sm:rounded-lg sm:border sm:border-gray-200 p-3 sm:p-10 mt-0 sm:mt-8 max-w-2xl mx-auto">
                <!-- Mobile headline (current size) -->
                <h1 class="text-4xl font-bold text-slate-900 mb-2 leading-none sm:hidden">
                    Get Your <span class="text-hyperlink-blue">Exit Score</span> in 3 Minutes
                </h1>
                
                <!-- Desktop headline (2x larger) -->
                <h1 class="hidden sm:block text-6xl font-bold text-slate-900 mb-4 leading-none">
                    Get Your <span class="text-hyperlink-blue">Exit Score</span> in 3 Minutes
                </h1>
                
                <h2 class="text-xl sm:text-xl text-gray-600 mb-6 font-medium leading-relaxed hidden sm:block">
                    Unlock Your Business Value: AI-Powered Assessment Reveals 90% of Hidden Sale Barriers
                </h2>
                
                <!-- Desktop benefits - right after subtitle -->
                <div class="space-y-4 mb-6 hidden sm:block">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-green-500 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-gray-700 text-base font-medium">26-point analysis in 3 minutes</span>
                    </div>
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-green-500 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-gray-700 text-base font-medium">Instant score & improvement areas</span>
                    </div>
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-green-500 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-gray-700 text-base font-medium">Steps to increase sale price</span>
                    </div>
                </div>
                
                <p class="text-lg sm:text-lg text-gray-700 mb-6 leading-relaxed">
                    Get an instant score and AI-generated recommendations based on M&A market data.
                </p>
                
                <!-- Industry Selection - improved for mobile -->
                <div class="mb-5">
                    <label class="block text-lg sm:text-base font-bold text-gray-700 mb-2">What's your industry? *</label>
                    <select id="industry" name="industry" required class="w-full p-4 text-lg sm:text-lg font-medium border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white appearance-none">
                        <option value="">Select your industry</option>
                        <option value="Agriculture">Agriculture</option>
                        <option value="Aerospace & Defense">Aerospace & Defense</option>
                        <option value="Automotive">Automotive</option>
                        <option value="Beauty & Personal Care">Beauty & Personal Care</option>
                        <option value="Biotech & Life Sciences">Biotech & Life Sciences</option>
                        <option value="Business Services">Business Services</option>
                        <option value="CleanTech & Renewable Energy">CleanTech & Renewable Energy</option>
                        <option value="Construction">Construction</option>
                        <option value="Distribution/Wholesale">Distribution/Wholesale</option>
                        <option value="E-commerce">E-commerce</option>
                        <option value="Education">Education</option>
                        <option value="Energy">Energy</option>
                        <option value="Entertainment & Media">Entertainment & Media</option>
                        <option value="Environmental Services">Environmental Services</option>
                        <option value="Financial Services">Financial Services</option>
                        <option value="Food & Beverage">Food & Beverage</option>
                        <option value="Forestry & Timber">Forestry & Timber</option>
                        <option value="Franchise Operations">Franchise Operations</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Home Services">Home Services</option>
                        <option value="Industrial Services">Industrial Services</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Professional Services">Professional Services</option>
                        <option value="Real Estate">Real Estate</option>
                        <option value="Retail">Retail</option>
                        <option value="Software/SaaS">Software/SaaS</option>
                        <option value="Technology">Technology</option>
                        <option value="Transportation & Logistics">Transportation & Logistics</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <button onclick="startAssessment()" class="btn-primary w-full py-5 px-6 rounded-xl text-white font-bold text-lg sm:text-lg shadow-xl transform transition-transform active:scale-98 mb-3">
                    Start Assessment →
                </button>
                
                <!-- Mobile micro copy - right under button -->
                <p class="text-sm text-gray-500 mb-4 text-center leading-relaxed sm:hidden">
                    No payment required • 100% confidential
                </p>
                
                <!-- Desktop micro copy - right under button -->
                <p class="text-sm text-gray-500 mb-4 text-center leading-relaxed hidden sm:block">
                    No payment required • 100% confidential
                </p>
                
                <!-- Mobile benefits - moved below micro copy -->
                <div class="space-y-3 mb-4 sm:hidden">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-green-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-gray-700 text-base font-medium">26-point analysis in 3 minutes</span>
                    </div>
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-green-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-gray-700 text-base font-medium">Instant score & improvement areas</span>
                    </div>
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-green-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-gray-700 text-base font-medium">Steps to increase sale price</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Revenue Selection Screen -->
        <div id="revenueSelection" class="question-screen hidden">
            <div class="sm:bg-white sm:rounded-lg sm:border sm:border-gray-200 p-4 sm:p-10 mt-0 sm:mt-8 max-w-2xl mx-auto">
                <div class="mb-6">
                    <span class="text-xs sm:text-sm text-hyperlink-blue font-bold uppercase tracking-wider">Business Profile</span>
                    <div class="text-sm text-gray-500 mt-1">Step 1 of 3</div>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-900 mb-6">
                    What is your approximate annual revenue?
                </h2>
                <p class="text-gray-600 mb-8 text-sm sm:text-base">
                    This helps us provide more accurate recommendations for your business size.
                </p>
                <div class="space-y-3">
                    <button onclick="selectRevenue('Under $500K', 250000)" class="revenue-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">Under $500K</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectRevenue('$500K - $1M', 750000)" class="revenue-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">$500K - $1M</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectRevenue('$1M - $2M', 1500000)" class="revenue-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">$1M - $2M</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectRevenue('$2M - $5M', 3500000)" class="revenue-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">$2M - $5M</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectRevenue('$5M - $10M', 7500000)" class="revenue-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">$5M - $10M</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectRevenue('$10M - $25M', 17500000)" class="revenue-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">$10M - $25M</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectRevenue('$25M - $50M', 37500000)" class="revenue-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">$25M - $50M</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectRevenue('Over $50M', 75000000)" class="revenue-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">Over $50M</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Employee Count Selection Screen -->
        <div id="employeeSelection" class="question-screen hidden">
            <div class="sm:bg-white sm:rounded-lg sm:border sm:border-gray-200 p-4 sm:p-10 mt-0 sm:mt-8 max-w-2xl mx-auto">
                <div class="mb-6">
                    <span class="text-xs sm:text-sm text-hyperlink-blue font-bold uppercase tracking-wider">Business Profile</span>
                    <div class="text-sm text-gray-500 mt-1">Step 2 of 3</div>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-900 mb-6">
                    How many employees does your business have?
                </h2>
                <p class="text-gray-600 mb-8 text-sm sm:text-base">
                    Include yourself and any full-time, part-time, or contract workers.
                </p>
                <div class="space-y-3">
                    <button onclick="selectEmployees('Just me', 1)" class="employee-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">Just me (sole proprietor)</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectEmployees('2-5 employees', 3)" class="employee-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">2-5 employees</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectEmployees('6-10 employees', 8)" class="employee-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">6-10 employees</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectEmployees('11-25 employees', 18)" class="employee-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">11-25 employees</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectEmployees('26-50 employees', 38)" class="employee-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">26-50 employees</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectEmployees('51-100 employees', 75)" class="employee-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">51-100 employees</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                    <button onclick="selectEmployees('Over 100 employees', 150)" class="employee-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 hover:border-green-500 hover:bg-green-50 focus:outline-none focus:ring-0 transition-all group">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-gray-900">Over 100 employees</span>
                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-green-500 transition-colors"></div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Business Location (Zip Code) Selection Screen -->
        <div id="zipcodeSelection" class="question-screen hidden">
            <div class="sm:bg-white sm:rounded-lg sm:border sm:border-gray-200 p-4 sm:p-10 mt-0 sm:mt-8 max-w-2xl mx-auto">
                <div class="mb-6">
                    <span class="text-xs sm:text-sm text-hyperlink-blue font-bold uppercase tracking-wider">Business Profile</span>
                    <div class="text-sm text-gray-500 mt-1">Step 3 of 3</div>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-900 mb-6">
                    What is your business location?
                </h2>
                <p class="text-gray-600 mb-8 text-sm sm:text-base">
                    This helps us provide location-specific market insights and valuations.
                </p>
                <div class="mb-8">
                    <label for="zipcodeSelectionInput" class="block text-sm font-medium text-gray-700 mb-3">Business Location (Zip Code) *</label>
                    <input type="text" id="zipcodeSelectionInput" name="zipcode" required pattern="[0-9]{5}" maxlength="5" minlength="5" placeholder="12345" autocomplete="postal-code" inputmode="numeric" class="w-full p-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                </div>
                <button onclick="selectZipcode()" class="btn-primary w-full py-4 px-6 rounded-xl text-white font-semibold text-lg">
                    Continue to Assessment →
                </button>
            </div>
        </div>

        <!-- Question Template (Hidden, will be cloned) -->
        <div id="questionTemplate" class="question-screen hidden">
            <div class="sm:bg-white sm:rounded-lg sm:border sm:border-gray-200 p-4 sm:p-8 mt-0 sm:mt-8 fade-in max-w-2xl mx-auto">
                <div class="mb-6">
                    <span class="text-xs sm:text-sm text-hyperlink-blue font-bold uppercase tracking-wider category-label">Category</span>
                    <div class="text-sm text-gray-500 mt-1 hidden sm:block">
                        Question <span class="current-q">1</span> of <span class="total-q">26</span>
                    </div>
                </div>
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-900 mb-8 leading-snug question-text">
                    Question goes here?
                </h2>
                <div class="space-y-3" id="optionsContainer"></div>
                <button onclick="goBack()" class="mt-6 text-gray-500 hover:text-gray-700 text-sm flex items-center transition-colors">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back
                </button>
                <div class="text-center mt-8 pt-4 border-t border-gray-100">
                    <p class="text-xs text-gray-400">© 2025 ARX Business Brokers. All rights reserved.</p>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results" class="hidden">
            <div class="sm:bg-white sm:rounded-xl sm:shadow-lg p-6 sm:p-8 mt-0 sm:mt-8 fade-in">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Your Sales Readiness Score</h2>
                <div class="text-6xl font-bold text-orange-600 my-8">
                    <span id="scoreValue">0</span>%
                </div>
                <div id="scoreInterpretation" class="text-lg text-gray-700 mb-3"></div>
                <div id="ctaSubhead" class="text-sm text-gray-600 mb-4"></div>
                
                <button id="ctaButton" onclick="showDetailedReport()" class="btn-primary w-full py-4 px-6 rounded-lg text-white font-semibold text-lg mb-2 no-print">
                    Continue →
                </button>
                <div id="ctaMicro" class="text-xs text-gray-500 mb-6 text-center">Free, confidential. Advisor‑reviewed within 1 business day.</div>
                
                <h3 id="companyScoreHeadline" class="text-2xl font-bold text-slate-900 mb-6 text-center"></h3>
                
                <div id="categoryBreakdown" class="space-y-4 mb-8">
                    <!-- Category scores will be populated here -->
                </div>
                
                <div class="bg-gray-50 rounded-lg p-6 mb-6 no-print">
                    <h3 class="text-xl font-semibold text-slate-900 mb-3">Your Complete Analysis Includes:</h3>
                    <ul class="space-y-2 text-gray-700 mb-4">
                        <li class="flex items-start"><svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span>Top 3 value levers to lift sale price</span></li>
                        <li class="flex items-start"><svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span>Risk heatmap and quick wins</span></li>
                        <li class="flex items-start"><svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span>90‑day preparation plan by revenue range</span></li>
                        <li class="flex items-start"><svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span>Buyer questions and talk tracks</span></li>
                        <li class="flex items-start"><svg class="w-5 h-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span>What to change before diligence</span></li>
                    </ul>
                </div>
                
                <div class="text-center no-print">
                    <p class="text-gray-600 mb-3">Ready to take the next step towards your successful exit?</p>
                    <a href="#" onclick="showDetailedReport(); return false;" class="inline-block text-hyperlink-blue hover:text-blue-700 font-semibold underline">
                        Start your personalized consultation today
                    </a>
                    <div class="mt-6">
                        <button onclick="printReport()" class="py-3 px-5 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 no-print">Print / Save as PDF</button>
                    </div>
                </div>
                
                <p class="text-sm text-gray-500 mt-6 text-center">
                    Prepared by experienced M&A professionals • Delivered within 1 business day
                </p>
            </div>
        </div>

        <!-- Lead Capture Form -->
        <div id="leadCapture" class="hidden">
            <div class="sm:bg-white sm:rounded-xl sm:shadow-lg p-6 sm:p-8 mt-0 sm:mt-8 fade-in">
                <h2 id="leadHeading" class="text-2xl font-bold text-slate-900 mb-2">Get Your 3 Most Critical Steps to Sell in the Next 6 Months</h2>
                <p id="leadDesc" class="text-gray-600 mb-6">
                    We'll send you a personalized action plan with your Business Sale Readiness Score and specific priorities based on your assessment.
                </p>
                <form id="leadForm" onsubmit="submitLeadForm(event)">
                    <input type="text" id="honeypot" name="honeypot" style="position:absolute;left:-9999px;opacity:0;height:0;width:0;border:0;padding:0;margin:0;pointer-events:none" tabindex="-1" autocomplete="new-password" aria-hidden="true" readonly>
                    
                    <div id="errorMessage" class="error-message" role="alert"></div>
                    <div id="successMessage" class="success-message" role="status"></div>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="nameInput" class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                            <input type="text" id="nameInput" name="name" autocomplete="name" required placeholder="First Last" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label for="emailInput" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" id="emailInput" name="email" autocomplete="email" required placeholder="your.name@company.com" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                    
                    <!-- No reCAPTCHA (temporarily removed) -->
                    
                    <button type="submit" id="submitBtn" class="btn-primary w-full py-4 px-6 rounded-lg text-white font-semibold text-lg mt-6">
                        <span id="submitBtnText">Get My Report →</span>
                        <span id="submitBtnLoading" class="hidden">
                            <div class="loading-spinner"></div>
                            Processing Assessment...
                        </span>
                    </button>
                    <p class="text-xs text-gray-500 mt-4 text-center flex items-center justify-center">
                        <svg class="w-3 h-3 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        Your information is 100% confidential and will never be shared.
                    </p>
                </form>
            </div>
        </div>

        <!-- Additional Details Form -->
        <div id="additionalDetails" class="hidden">
            <div class="sm:bg-white sm:rounded-xl sm:shadow-lg p-6 sm:p-8 mt-0 sm:mt-8 fade-in">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900 mb-2">Last Step: Personalize Your Report</h2>
                    <p class="text-gray-600 mb-4">
                        Add these details so we can tailor your 90‑day plan, buyer questions, and valuation guidance to your business. We never share your information.
                    </p>
                </div>
                
                <form id="additionalDetailsForm" onsubmit="submitAdditionalDetails(event)">
                    <input type="text" id="honeypot2" name="honeypot" style="position:absolute;left:-9999px;opacity:0;height:0;width:0;border:0;padding:0;margin:0;pointer-events:none" tabindex="-1" autocomplete="new-password" aria-hidden="true" readonly>
                    
                    <div id="errorMessage2" class="error-message" role="alert"></div>
                    <div id="successMessage2" class="success-message" role="status"></div>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="companyInputStep2" class="block text-sm font-medium text-gray-700 mb-1">Company Name *</label>
                            <input type="text" id="companyInputStep2" name="company" autocomplete="organization" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Acme Services, LLC">
                            <p class="text-xs text-gray-500 mt-1">Appears on your report; used to tailor guidance.</p>
                        </div>
                        <div>
                            <label for="phoneInputStep2" class="block text-sm font-medium text-gray-700 mb-1">Best Phone *</label>
                            <input type="tel" name="phone" id="phoneInputStep2" placeholder="(555) 123-4567" autocomplete="tel" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <p class="text-xs text-gray-500 mt-1">Only used for your report or questions—never shared.</p>
                        </div>
                        <div>
                            <label for="websiteInputStep2" class="block text-sm font-medium text-gray-700 mb-1">Company Website *</label>
                            <input type="url" id="websiteInputStep2" name="website" placeholder="https://yourcompany.com" autocomplete="url" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <p class="text-xs text-gray-500 mt-1">Helps us align advice to your market and buyers.</p>
                        </div>
                    </div>
                    
                    <button type="submit" id="submitBtn2" class="btn-primary w-full py-4 px-6 rounded-lg text-white font-semibold text-lg mt-6">
                        <span id="submitBtnText2">Finish and Send My Report →</span>
                        <span id="submitBtnLoading2" class="hidden">
                            <div class="loading-spinner"></div>
                            Updating Your Profile...
                        </span>
                    </button>
                    <p class="text-sm text-gray-500 mt-4 text-center">Private and confidential. We never sell or share your information.</p>
                    <button type="button" onclick="skipAdditionalDetails()" class="w-full py-2 px-4 text-gray-600 hover:text-gray-800 text-sm mt-2 underline">
                        Skip - Send My Report Now
                    </button>
                </form>
            </div>
        </div>

        <!-- Thank You Screen -->
        <div id="thankYou" class="hidden">
            <div class="sm:bg-white sm:rounded-xl sm:shadow-lg p-6 sm:p-8 mt-0 sm:mt-8 fade-in text-center">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-slate-900 mb-4">Your Report is Being Prepared</h2>
                <p class="text-lg text-gray-700 mb-6">
                    Thank you for completing the assessment! Your personalized analysis is now being reviewed by one of our experienced M&A professionals.
                </p>
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6">
                    <h3 class="font-semibold text-orange-800 mb-2">What happens next:</h3>
                    <ul class="text-left text-orange-700 space-y-1">
                        <li>• Our team reviews your responses and industry context</li>
                        <li>• We prepare your customized recommendations</li>
                        <li>• Your complete report arrives in your inbox within 1 business day</li>
                    </ul>
                </div>
                <p class="text-gray-600 mb-6">
                    <strong>Can't wait?</strong> One of our senior advisors may reach out to discuss your preliminary results and answer any immediate questions about your business sale preparation.
                </p>
                <div class="mb-6">
                    <a href="https://savvycal.com/brecht/SMB" target="_blank" rel="noopener noreferrer" class="btn-primary inline-block py-3 px-8 rounded-lg text-white font-semibold text-lg hover:opacity-90 transition-all">
                        📞 Book a Call Now
                    </a>
                </div>
                <p class="text-sm text-gray-500">
                    Check your email (including spam folder) for your detailed analysis report.
                </p>
            </div>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div id="processingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4 text-center">
            <div class="loading-spinner mx-auto mb-4" style="border-top-color: #000; width: 40px; height: 40px;"></div>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">Processing Your Assessment</h3>
            <div id="processingSteps" class="text-sm text-gray-600 space-y-1">
                <div id="step1" class="flex items-center justify-center">
                    <span class="inline-block w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                    Analyzing your responses
                </div>
                <div id="step2" class="flex items-center justify-center opacity-50">
                    <span class="inline-block w-2 h-2 bg-gray-300 rounded-full mr-2"></span>
                    Generating AI recommendations
                </div>
                <div id="step3" class="flex items-center justify-center opacity-50">
                    <span class="inline-block w-2 h-2 bg-gray-300 rounded-full mr-2"></span>
                    Preparing your report
                </div>
            </div>
            <p class="text-xs text-gray-500 mt-4">This may take 10-15 seconds</p>
        </div>
    </div>

    <script>
        // Assessment Data - loaded from JSON
        // Updated categories to match JSON structure (26 questions total)
        let categories = [
            {
                name: "Risk of Change of Ownership",
                weight: 0.3,
                questions: [
                    {
                        id: 1,
                        text: "Can your business operate profitably for 30+ days without you being present?",
                        weight: 0.35,
                        yesText: "Business runs independently",
                        noText: "Owner dependency risk"
                    },
                    {
                        id: 2,
                        text: "Are all critical business processes documented so someone else could follow them?",
                        weight: 0.22,
                        yesText: "Systems documented",
                        noText: "Tribal knowledge"
                    },
                    {
                        id: 3,
                        text: "Do you have at least one key employee who could manage daily operations?",
                        weight: 0.18,
                        yesText: "Management depth",
                        noText: "Single person operation"
                    },
                    {
                        id: 4,
                        text: "Are the majority of your key customer relationships maintained by employees other than yourself?",
                        weight: 0.12,
                        yesText: "Institutional relationships",
                        noText: "Owner-dependent relationships"
                    },
                    {
                        id: 5,
                        text: "Are your business operations independent of licenses or certifications held personally by you?",
                        weight: 0.13,
                        yesText: "Transferable operations",
                        noText: "Owner-dependent credentials"
                    }
                ]
            },
            {
                name: "Company Growth",
                weight: 0.2,
                questions: [
                    {
                        id: 6,
                        text: "Has your business grown revenue in the past 12 months?",
                        weight: 0.45,
                        yesText: "Currently growing",
                        noText: "Stagnant or declining"
                    },
                    {
                        id: 7,
                        text: "Has your revenue increased in at least 3 of the last 4 years?",
                        weight: 0.35,
                        yesText: "Consistent growth pattern",
                        noText: "Inconsistent performance"
                    },
                    {
                        id: 8,
                        text: "Do you have a documented plan or strategy for growing your business?",
                        weight: 0.2,
                        yesText: "Growth strategy in place",
                        noText: "No growth planning"
                    }
                ]
            },
            {
                name: "Industry Growth",
                weight: 0.15,
                questions: [
                    {
                        id: 9,
                        text: "Is demand for your type of business generally increasing?",
                        weight: 0.6,
                        yesText: "Growing industry",
                        noText: "Declining industry"
                    },
                    {
                        id: 10,
                        text: "Is your industry expected to grow or remain stable over the next 5 years?",
                        weight: 0.4,
                        yesText: "Stable/growing industry outlook",
                        noText: "Declining industry outlook"
                    }
                ]
            },
            {
                name: "Market Demand",
                weight: 0.15,
                questions: [
                    {
                        id: 11,
                        text: "Do you have repeat customers or predictable revenue streams?",
                        weight: 0.25,
                        yesText: "Stable revenue model",
                        noText: "Unpredictable revenue"
                    },
                    {
                        id: 12,
                        text: "Does your business generate predictable monthly revenue without heavy seasonal fluctuations?",
                        weight: 0.2,
                        yesText: "Stable revenue pattern",
                        noText: "Volatile revenue"
                    },
                    {
                        id: 13,
                        text: "Is your business resistant to being replaced by technology or automation?",
                        weight: 0.2,
                        yesText: "Technology resistant",
                        noText: "Automation vulnerable"
                    },
                    {
                        id: 14,
                        text: "Can your business operate with less than $100,000 in specialized equipment or machinery?",
                        weight: 0.15,
                        yesText: "Low equipment barrier",
                        noText: "Equipment intensive"
                    },
                    {
                        id: 15,
                        text: "Could someone with general business experience learn to run your business within 6 months?",
                        weight: 0.12,
                        yesText: "Accessible skillset",
                        noText: "Specialized expertise required"
                    },
                    {
                        id: 16,
                        text: "Can your business generate consistent revenue with minimal day-to-day owner involvement?",
                        weight: 0.08,
                        yesText: "Absentee friendly",
                        noText: "Hands-on required"
                    }
                ]
            },
            {
                name: "Company Rating",
                weight: 0.1,
                questions: [
                    {
                        id: 17,
                        text: "Are your financial records prepared by a bookkeeper or accountant?",
                        weight: 0.25,
                        yesText: "Professional records",
                        noText: "DIY bookkeeping"
                    },
                    {
                        id: 18,
                        text: "Do you keep business and personal expenses completely separate?",
                        weight: 0.2,
                        yesText: "Clean financial separation",
                        noText: "Mixed expenses"
                    },
                    {
                        id: 19,
                        text: "Do your profit & loss statements closely match what you report on your tax returns?",
                        weight: 0.2,
                        yesText: "Clean financial reporting",
                        noText: "Reporting discrepancies"
                    },
                    {
                        id: 20,
                        text: "Do you keep more than 10 cents profit from every dollar of revenue?",
                        weight: 0.18,
                        yesText: "Healthy profit margins",
                        noText: "Thin margins"
                    },
                    {
                        id: 21,
                        text: "Does your largest customer represent less than 20% of your total revenue?",
                        weight: 0.12,
                        yesText: "Diversified customer base",
                        noText: "Customer concentration risk"
                    },
                    {
                        id: 22,
                        text: "Do you have written contracts or agreements with your key customers?",
                        weight: 0.05,
                        yesText: "Documented relationships",
                        noText: "Handshake agreements"
                    }
                ]
            },
            {
                name: "Competitiveness",
                weight: 0.1,
                questions: [
                    {
                        id: 23,
                        text: "Can you charge similar or higher prices than your main competitors?",
                        weight: 0.36,
                        yesText: "Pricing power",
                        noText: "Price competition pressure"
                    },
                    {
                        id: 24,
                        text: "Do you have a 4-star rating or higher online, or can you provide 10+ positive customer references?",
                        weight: 0.29,
                        yesText: "Strong reputation",
                        noText: "Reputation concerns"
                    },
                    {
                        id: 25,
                        text: "Do potential customers contact you directly without heavy marketing?",
                        weight: 0.21,
                        yesText: "Strong market presence",
                        noText: "Weak market presence"
                    },
                    {
                        id: 26,
                        text: "Do you regularly win new customers each month?",
                        weight: 0.14,
                        yesText: "Active customer acquisition",
                        noText: "Struggling to grow"
                    }
                ]
            }
        ];

        // Load questions from JSON via external module
        async function loadQuestions() {
            try {
                const loaded = await (window.fetchQuestions ? window.fetchQuestions() : Promise.reject(new Error('questions module missing')));
                categories = loaded;
                totalQuestions = categories.reduce((sum, cat) => sum + cat.questions.length, 0);
                console.log(`✅ Loaded ${totalQuestions} questions from JSON successfully`);
                return true;
            } catch (error) {
                console.error('❌ Failed to load questions from JSON:', error);
                console.log('📂 Using fallback hardcoded questions');
                totalQuestions = categories.reduce((sum, cat) => sum + cat.questions.length, 0);
                return false;
            }
        }

        // No hardcoded credentials - all API calls go through our secure Netlify function

        // State Management
        let currentCategoryIndex = 0;
        let currentQuestionIndex = 0;
        let answers = [];
        let totalQuestions = 0; // Will be calculated after JSON loads
        let currentQuestionNumber = 0;
        let assessmentStartTime = null;
        let businessInfo = {};

        // Analytics are provided by assets/js/analytics.js (trackEvent, trackFBEvent)

        // Initialize
    document.addEventListener('DOMContentLoaded', async function() {
        // Load questions from JSON first
        await loadQuestions();
        
        // Track page view
        trackEvent('page_view', {
            page_title: 'Sales Readiness Assessment',
            page_location: window.location.href
        });
        
        // Try to restore saved progress
        restoreProgress();
        
        // Set up engagement tracking
        setupEngagementTracking();

        // Track consultation link clicks (e.g., SavvyCal)
        document.addEventListener('click', function(e) {
            const a = e.target.closest('a');
            if (!a) return;
            try {
                const href = (a.getAttribute('href') || '').toLowerCase();
                if (href.includes('savvycal.com')) {
                    const score = parseInt(document.getElementById('scoreValue')?.textContent || '0') || 0;
                    trackEvent('consultation_click', {
                        href: a.href,
                        text: (a.textContent || '').trim(),
                        score: score,
                        industry: businessInfo?.industry || ''
                    });
                    // Meta Pixel standard Contact event
                    try { trackFBEvent('Contact', { value: 0, currency: 'USD' }); } catch(_) {}
                }
            } catch (_) {}
        }, { capture: true });
    });
        
        // Engagement tracking setup
        function setupEngagementTracking() {
            let engagedTracked = false;
            let abandonmentTracked = false;
            let pageLoadTime = Date.now();
            
            // Track engaged user at 60 seconds
            setTimeout(() => {
                if (!engagedTracked) {
                    trackEvent('engaged_user', {
                        time_on_page: 60
                    });
                    engagedTracked = true;
                }
            }, 60000);
            
            // Track quick abandonment at 30 seconds if user hasn't started
            setTimeout(() => {
                if (!abandonmentTracked && !assessmentStartTime) {
                    trackEvent('quick_abandonment', {
                        time_on_page: 30
                    });
                    abandonmentTracked = true;
                }
            }, 30000);
            
            // Track when user leaves page
            window.addEventListener('beforeunload', function() {
                const timeOnPage = Math.floor((Date.now() - pageLoadTime) / 1000);
                trackEvent('page_exit', {
                    time_on_page: timeOnPage,
                    assessment_started: !!assessmentStartTime,
                    answers_given: answers.length
                });
            });
        }

        function startAssessment() {
            // Validate industry selection
            const industry = document.getElementById('industry').value;
            
            if (!industry) {
                alert('Please select your industry before starting the assessment.');
                return;
            }
            
            // Store business information
            businessInfo = {
                industry: industry,
                website: null, // Will be set from lead form
                revenue: null,
                revenueNumeric: null,
                employees: null,
                employeesNumeric: null
            };
            
            document.getElementById('welcome').classList.add('hidden');
            assessmentStartTime = Date.now(); // Track start time for spam protection
            showScreen('revenueSelection');
            
            // Update progress bar - step 1 of 4
            document.getElementById('progressBar').style.width = '25%';
            
            // Save progress
            saveProgress();
            
            // Track revenue selection start
            trackEvent('revenue_selection_start', {
                industry: industry
            });
            trackEvent('begin_checkout', {
                value: 0,
                currency: 'USD',
                items: [{
                    item_name: 'Sales Readiness Assessment',
                    item_category: 'Lead Generation'
                }],
                custom_parameter_2: industry
            });
        }
        
        function selectRevenue(displayText, numericValue) {
            if (document.activeElement) { try { document.activeElement.blur(); } catch(_){} }
            businessInfo.revenue = displayText;
            businessInfo.revenueNumeric = numericValue;
            
            // Add visual feedback
            document.querySelectorAll('.revenue-btn').forEach(btn => {
                btn.classList.remove('border-green-500', 'bg-green-50');
                btn.classList.add('border-gray-200');
                btn.querySelector('.w-6').classList.remove('bg-green-500');
                btn.querySelector('.w-6').classList.add('border-gray-300');
            });
            
            event.target.closest('.revenue-btn').classList.add('border-green-500', 'bg-green-50');
            event.target.closest('.revenue-btn').querySelector('.w-6').classList.add('bg-green-500');
            event.target.closest('.revenue-btn').querySelector('.w-6').classList.remove('border-gray-300');
            // Haptics
            try { if (navigator.vibrate) navigator.vibrate(10); } catch(_){}
            
            // Auto-advance after selection
            setTimeout(() => {
                // Track revenue selection completion
                trackEvent('revenue_selection_complete', {
                    revenue_range: displayText,
                    revenue_numeric: numericValue
                });
                
                showScreen('employeeSelection');
                
                // Update progress bar - step 2 of 4
                document.getElementById('progressBar').style.width = '50%';
                
                // Track employee selection start
                trackEvent('employee_selection_start', {
                    revenue_range: displayText
                });
                
                // Save progress
                saveProgress();
            }, 500);
        }
        
        function selectEmployees(displayText, numericValue) {
            if (document.activeElement) { try { document.activeElement.blur(); } catch(_){} }
            businessInfo.employees = displayText;
            businessInfo.employeesNumeric = numericValue;
            
            // Add visual feedback
            document.querySelectorAll('.employee-btn').forEach(btn => {
                btn.classList.remove('border-green-500', 'bg-green-50');
                btn.classList.add('border-gray-200');
                btn.querySelector('.w-6').classList.remove('bg-green-500');
                btn.querySelector('.w-6').classList.add('border-gray-300');
            });
            
            event.target.closest('.employee-btn').classList.add('border-green-500', 'bg-green-50');
            event.target.closest('.employee-btn').querySelector('.w-6').classList.add('bg-green-500');
            event.target.closest('.employee-btn').querySelector('.w-6').classList.remove('border-gray-300');
            // Haptics
            try { if (navigator.vibrate) navigator.vibrate(10); } catch(_){}
            
            // Auto-advance after selection
            setTimeout(() => {
                // Track employee selection completion
                trackEvent('employee_selection_complete', {
                    employee_range: displayText,
                    employee_numeric: numericValue
                });
                
                // Move to zipcode selection
                showScreen('zipcodeSelection');
                // Save progress
                saveProgress();
            }, 500);
        }
        
        function selectZipcode() {
            const zipInput = document.getElementById('zipcodeSelectionInput');
            const zipcode = zipInput.value.trim();
            
            if (!zipcode || zipcode.length !== 5 || !/^\d{5}$/.test(zipcode)) {
                zipInput.focus();
                zipInput.classList.add('border-red-500');
                return;
            }
            
            businessInfo.zipcode = zipcode;
            zipInput.classList.remove('border-red-500');
            try { if (navigator.vibrate) navigator.vibrate(10); } catch(_){}
            
            // Track zipcode completion
            trackEvent('zipcode_selection_complete', {
                zipcode: zipcode
            });
            
            // Move to first assessment question
            showQuestion();
            // Save progress
            saveProgress();
        }
        
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.question-screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // Show requested screen
            document.getElementById(screenId).classList.remove('hidden');

            // Expand header on non-question screens
            if (screenId === 'welcome' || screenId === 'revenueSelection' || screenId === 'employeeSelection' || screenId === 'zipcodeSelection') {
                try { document.querySelector('header')?.classList.remove('compact'); } catch(_){}
                try { document.getElementById('progressDots')?.classList.add('hidden'); } catch(_){}
            }
        }

        function showQuestion() {
            const category = categories[currentCategoryIndex];
            const question = category.questions[currentQuestionIndex];
            currentQuestionNumber = getCurrentQuestionNumber();
            
            
            // Hide all screens
            document.querySelectorAll('.question-screen').forEach(el => el.classList.add('hidden'));
            document.getElementById('results').classList.add('hidden');
            document.getElementById('leadCapture').classList.add('hidden');
            document.getElementById('thankYou').classList.add('hidden');
            
            // Remove any existing question display
            const existing = document.getElementById('currentQuestion');
            if (existing) {
                existing.remove();
            }
            
            // Clone template and prepare new question
            const template = document.getElementById('questionTemplate');
            const questionDiv = template.cloneNode(true);
            questionDiv.id = 'currentQuestion';
            questionDiv.classList.remove('hidden');
            questionDiv.classList.add('fade-in');
            
            // Reset all button states to prevent carryover on mobile
            questionDiv.querySelectorAll('.answer-btn').forEach(btn => {
                // Remove all active states
                btn.classList.remove(
                    'border-green-500', 'bg-green-50', 
                    'border-red-500', 'bg-red-50', 
                    'border-gray-400', 'bg-gray-50',
                    'border-orange-500', 'bg-orange-50'
                );
                // Add neutral border
                btn.classList.add('border-gray-200');
                
                // Reset button icon backgrounds completely
                const iconDiv = btn.querySelector('.w-10, .w-12');
                if (iconDiv) {
                    // Remove all colored backgrounds
                    iconDiv.classList.remove(
                        'bg-green-200', 'bg-red-200', 'bg-gray-200', 
                        'bg-green-100', 'bg-red-100', 'bg-gray-100',
                        'bg-orange-200', 'bg-orange-100'
                    );
                    // Set default neutral background based on button type
                    if (btn.classList.contains('hover:border-green-500')) {
                        iconDiv.classList.add('bg-green-100');
                    } else if (btn.classList.contains('hover:border-red-500')) {
                        iconDiv.classList.add('bg-red-100');
                    } else {
                        iconDiv.classList.add('bg-gray-100');
                    }
                }
                
                // Remove any focus states
                btn.blur();
            });
            
            // Update content
            questionDiv.querySelector('.category-label').textContent = category.name.toUpperCase();
            questionDiv.querySelector('.current-q').textContent = currentQuestionNumber;
            questionDiv.querySelector('.total-q').textContent = totalQuestions;
            questionDiv.querySelector('.question-text').textContent = question.text;
            // Build options dynamically (default Yes/No/Not Sure)
            try {
                const opts = [
                    { value: true, label: 'Yes', description: question.yesText, tone: 'green' },
                    { value: false, label: 'No', description: question.noText, tone: 'red' },
                    { value: null, label: 'Not Sure', description: 'Skip this question', tone: 'gray' }
                ];
                const container = questionDiv.querySelector('#optionsContainer');
                container.innerHTML = '';
                const makeIcon = (tone) => {
                    const wrap = document.createElement('div');
                    wrap.className = `w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mr-4 flex-shrink-0 transition-colors ${tone==='green'?'bg-green-100':'gray'===tone?'bg-gray-100':'bg-red-100'}`;
                    wrap.innerHTML = tone==='green'
                      ? '<svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path></svg>'
                      : tone==='red'
                        ? '<svg class="w-5 h-5 sm:w-6 sm:h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg>'
                        : '<svg class="w-5 h-5 sm:w-6 sm:h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                    return wrap;
                };
                opts.forEach(o => {
                    // Normalize label for partial to keep UI consistent
                    if (o && o.value === 'partial') { o.label = 'Partially'; }
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = `answer-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 transition-all group`;
                    btn.addEventListener('click', (ev)=>answerQuestion(o.value, ev));
                    const inner = document.createElement('div');
                    inner.className = 'flex items-center pointer-events-none';
                    const icon = makeIcon(o.tone || 'gray');
                    const text = document.createElement('div');
                    text.innerHTML = `<div class="font-semibold text-gray-900 text-base">${o.label}</div><div class="text-sm text-gray-600">${o.description||''}</div>`;
                    inner.appendChild(icon);
                    inner.appendChild(text);
                    btn.appendChild(inner);
                    container.appendChild(btn);
                });
            } catch(_){}
            
            // Add to DOM
            const container = document.querySelector('.max-w-3xl');
            if (!container) {
                console.error('Container not found! Looking for .max-w-3xl');
                return;
            }
            container.appendChild(questionDiv);
            // Ensure no residual focus state on new buttons (iOS Safari quirk)
            try {
                questionDiv.querySelectorAll('.answer-btn').forEach(btn => btn.blur());
            } catch(_){}
            // Insert local (in-card) progress dots (no numeric count)
            try {
                const local = document.createElement('div');
                local.className = 'px-2 pt-2 pb-1';
                local.innerHTML = '<div class="flex items-center justify-center gap-1.5" id="localDots"></div>';
                questionDiv.prepend(local);
                renderProgressDotsInto(document.getElementById('localDots'), null);
                // Hide global dots row on question screens
                document.getElementById('progressDotsWrap')?.classList.add('hidden');
            } catch(_){}
            // Compact header on question screens
            try { document.querySelector('header')?.classList.add('compact'); } catch(_){}
            // Keep global dots hidden
            try { document.getElementById('progressDots')?.classList.add('hidden'); } catch(_){}
            
            // Track question view
            trackEvent('question_view', {
                question_number: currentQuestionNumber,
                category: category.name,
                question_id: question.id
            });

            // Update progress
            updateProgress();
            
            // Reset focus to prevent mobile highlight issue
            document.body.focus();
            setTimeout(() => { try { document.body.focus(); } catch(_){} }, 0);
            
            // Scroll to top smoothly
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function getCurrentQuestionNumber() {
            let num = 0;
            for (let i = 0; i < currentCategoryIndex; i++) {
                num += categories[i].questions.length;
            }
            return num + currentQuestionIndex + 1;
        }

        function answerQuestion(answer, event) {
            // Prevent default and stop propagation
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // Remove focus from the clicked button (fixes mobile highlight issue)
            if (document.activeElement) {
                document.activeElement.blur();
            }
            // Brief visual feedback and haptics
            try {
                const btn = event && (event.currentTarget || event.target.closest('.answer-btn'));
                if (btn) {
                    btn.classList.add('flash');
                    setTimeout(() => btn.classList.remove('flash'), 180);
                }
                if (navigator.vibrate) navigator.vibrate(10);
            } catch(_){}
            
            // Store answer
            answers.push({
                category: currentCategoryIndex,
                question: currentQuestionIndex,
                answer: answer
            });
            
            // Save progress after each answer
            saveProgress();
            
            // Track answer
            trackEvent('assessment_answer', {
                question_number: currentQuestionNumber,
                category: categories[currentCategoryIndex].name,
                answer: (answer === true ? 'yes' : (answer === false ? 'no' : (answer === null ? 'skip' : String(answer))))
            });
            
            // Track progress every 5 questions
            if (answers.length % 5 === 0) {
                trackEvent('assessment_progress', {
                    questions_answered: answers.length,
                    total_questions: totalQuestions,
                    progress_percentage: Math.round((answers.length / totalQuestions) * 100)
                });
            }
            
            // Move to next question
            currentQuestionIndex++;
            if (currentQuestionIndex >= categories[currentCategoryIndex].questions.length) {
                // Track category completion
                trackEvent('category_complete', {
                    category_name: categories[currentCategoryIndex].name,
                    category_index: currentCategoryIndex,
                    questions_in_category: categories[currentCategoryIndex].questions.length
                });
                
                currentCategoryIndex++;
                currentQuestionIndex = 0;
            }
            
            if (currentCategoryIndex >= categories.length) {
                calculateResults();
            } else {
                // Small delay to ensure blur completes before showing next question
                setTimeout(() => {
                    showQuestion();
                }, 50);
            }
        }

        function goBack() {
            if (answers.length > 0) {
                // Remove last answer
                answers.pop();
                
                // Move back one question
                currentQuestionIndex--;
                if (currentQuestionIndex < 0) {
                    currentCategoryIndex--;
                    if (currentCategoryIndex >= 0) {
                        currentQuestionIndex = categories[currentCategoryIndex].questions.length - 1;
                    }
                }
                
                // Check if we're back at the beginning of questions
                if (currentCategoryIndex < 0) {
                    // Reset to beginning of questions
                    currentCategoryIndex = 0;
                    currentQuestionIndex = 0;
                    
                    // Hide current question and go back to employee selection
                    const currentQuestion = document.getElementById('currentQuestion');
                    if (currentQuestion) {
                        currentQuestion.remove();
                    }
                    showScreen('employeeSelection');
                    
                    // Update progress bar back to step 2
                    document.getElementById('progressBar').style.width = '50%';
                } else {
                    // Show previous question
                    showQuestion();
                }
            } else {
                // No answers yet, determine what screen to go back to
                const currentQuestion = document.getElementById('currentQuestion');
                if (currentQuestion) {
                    currentQuestion.remove();
                }
                
                // Check current state to determine where to go back
                if (businessInfo && businessInfo.employees) {
                    // Go back to employee selection
                    businessInfo.employees = null;
                    businessInfo.employeesNumeric = null;
                    showScreen('employeeSelection');
                    document.getElementById('progressBar').style.width = '50%';
                } else if (businessInfo && businessInfo.revenue) {
                    // Go back to revenue selection  
                    businessInfo.revenue = null;
                    businessInfo.revenueNumeric = null;
                    showScreen('revenueSelection');
                    document.getElementById('progressBar').style.width = '25%';
                } else {
                    // Go back to welcome screen
                    document.getElementById('welcome').classList.remove('hidden');
                }
                
                document.getElementById('progressBar').style.width = '0%';
            }
        }

        function updateProgress() {
            // Progress starts at 50% after completing revenue/employee selection
            // Questions fill the remaining 50%
            const questionProgress = (currentQuestionNumber / totalQuestions) * 50;
            const progress = 50 + questionProgress;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Update local in-card progress UI if present; otherwise ignore
            if (currentQuestionNumber > 0) {
                try { renderProgressDotsInto(document.getElementById('localDots'), null); } catch(_){}
            } else {
                try { document.getElementById('progressDots')?.classList.add('hidden'); } catch(_){}
            }
        }

        // Render small progress dots (one per question)
        function renderProgressDotsInto(row, countEl) {
            if (!row) return;
            if (row.childElementCount !== totalQuestions) {
                row.innerHTML = '';
                for (let i = 1; i <= totalQuestions; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'dot w-3 h-3 sm:w-2.5 sm:h-2.5 rounded-full bg-gray-300';
                    row.appendChild(dot);
                }
            }
            // Update states
            for (let i = 0; i < totalQuestions; i++) {
                const dot = row.children[i];
                if (!dot) continue;
                dot.classList.remove('bg-gray-300','bg-hyperlink-blue','bg-green-500');
                const answered = i < answers.length;
                const current = (i + 1) === currentQuestionNumber;
                dot.classList.add(answered ? 'bg-hyperlink-blue' : 'bg-gray-300');
                if (current) {
                    dot.classList.remove('bg-hyperlink-blue');
                    dot.classList.add('bg-green-500');
                }
            }
            // Update textual label below dots
            if (countEl) countEl.textContent = `${currentQuestionNumber} of ${totalQuestions}`;
        }

        function calculateResults() {
            let totalScore = 0;
            
            categories.forEach((category, catIndex) => {
                let categoryScore = 0;
                category.questions.forEach((question, qIndex) => {
                    const answer = answers.find(a => 
                        a.category === catIndex && a.question === qIndex
                    );
                    if (answer) {
                        // Use per-option scoring if defined
                        let fraction = null;
                        if (Array.isArray(question.options) && question.options.length) {
                            const opt = question.options.find(o => o.value === answer.answer);
                            if (opt && typeof opt.scoreFraction === 'number') fraction = opt.scoreFraction;
                        }
                        if (fraction === null) {
                            // Fallback to legacy mapping
                            fraction = (answer.answer === true) ? 1 : (answer.answer === null ? 0.15 : 0);
                        }
                        categoryScore += question.weight * fraction;
                    }
                });
                totalScore += categoryScore * category.weight;
            });
            
            const finalScore = Math.round(totalScore * 100);
            showResults(finalScore);
        }

        function showResults(score) {
            // Hide current question if exists
            const currentQuestion = document.getElementById('currentQuestion');
            if (currentQuestion) {
                currentQuestion.classList.add('hidden');
            }
            
            // Show results
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('progressBar').style.width = '100%';
            
            // Animate score
            const scoreElement = document.getElementById('scoreValue');
            let displayScore = 0;
            const increment = score / 20;
            const timer = setInterval(() => {
                displayScore += increment;
                if (displayScore >= score) {
                    displayScore = score;
                    clearInterval(timer);
                }
                scoreElement.textContent = Math.round(displayScore);
            }, 50);
            
            let interpretation = '';
            let cta = '';
            let sub = '';
            if (score >= 86) {
                interpretation = 'Premium Readiness — positioned for competitive offers.';
                cta = 'Get My Premium Seller Strategy →';
                sub = 'Lock in premium price and avoid diligence surprises.';
            } else if (score >= 76) {
                interpretation = 'Strong Position — minor optimizations can boost price and speed.';
                cta = 'Unlock My Optimization Plan →';
                sub = 'See the final tweaks to maximize offers.';
            } else if (score >= 60) {
                interpretation = 'Above Average Readiness — solid base with clear opportunities.';
                cta = 'Get My 3 Key Improvements →';
                sub = 'See exactly what to fix first to attract premium buyers.';
            } else if (score >= 45) {
                interpretation = 'Below Average Readiness — buyers will flag risks that reduce price.';
                cta = 'See My Priority Fixes →';
                sub = 'Remove the issues that cause valuation discounts.';
            } else {
                interpretation = 'Significant Preparation Needed — avoid deal‑killers before going to market.';
                cta = 'Get My Recovery Plan →';
                sub = 'Fix foundational risks buyers penalize most.';
            }
            document.getElementById('scoreInterpretation').textContent = interpretation;
            document.getElementById('ctaSubhead').textContent = sub;
            const ctaBtn = document.getElementById('ctaButton');
            if (ctaBtn) ctaBtn.textContent = cta;
            // Store CTA for carry-over to lead form
            window.scoreCTA = { label: cta, sub };
            
            // Set company headline
            const companyName = businessInfo.company || 'Your Business';
            document.getElementById('companyScoreHeadline').textContent = `${companyName} Sales Readiness Score`;
            
            // Calculate and display category scores
            displayCategoryBreakdown();
            
            // Set up exit intent
            setupExitIntent();
            
            // Track completion
            trackEvent('assessment_complete', {
                score: score,
                score_category: score >= 86 ? 'premium' : score >= 76 ? 'strong' : score >= 60 ? 'above_average' : score >= 45 ? 'below_average' : 'needs_improvement',
                custom_parameter_1: score,
                custom_parameter_2: businessInfo.industry
            });
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }


        function displayCategoryBreakdown() {
            const categoryBreakdownDiv = document.getElementById('categoryBreakdown');
            
            // Category importance descriptions
            const categoryDescriptions = {
                "Risk of Change of Ownership": "This is the most critical factor buyers evaluate - can the business succeed without you?",
                "Company Growth": "Consistent growth demonstrates market demand and management effectiveness to potential buyers.",
                "Industry Growth": "Buyers prefer businesses in growing or stable industries with long-term viability.",
                "Market Demand": "Sustainable competitive advantages and market positioning directly impact valuation multiples.",
                "Company Rating": "Clean financials and professional operations facilitate due diligence and buyer confidence.",
                "Competitiveness": "Strong market position and competitive differentiation support premium valuations."
            };
            
            let breakdownHTML = '';
            
            categories.forEach((category, categoryIndex) => {
                // Calculate category score
                let categoryScore = 0;
                let totalPossibleScore = 0;
                
                category.questions.forEach((question) => {
                    totalPossibleScore += question.weight;
                    
                    const answer = answers.find(a => 
                        a.category === categoryIndex && 
                        categories[a.category].questions[a.question].id === question.id
                    );
                    
                    if (answer) {
                        let fraction = null;
                        if (Array.isArray(question.options) && question.options.length) {
                            const opt = question.options.find(o => o.value === answer.answer);
                            if (opt && typeof opt.scoreFraction === 'number') fraction = opt.scoreFraction;
                        }
                        if (fraction === null) {
                            fraction = (answer.answer === true) ? 1 : (answer.answer === null ? 0.15 : 0);
                        }
                        categoryScore += question.weight * fraction;
                    }
                });
                
                const categoryPercentage = totalPossibleScore > 0 ? Math.round((categoryScore / totalPossibleScore) * 100) : 0;
                const status = categoryPercentage >= 80 ? {label:'Strong', cls:'text-green-600'} : (categoryPercentage >= 50 ? {label:'Moderate', cls:'text-amber-600'} : {label:'Needs Attention', cls:'text-red-600'});
                breakdownHTML += `
                    <div class="border-l-4 border-hyperlink-blue pl-4 py-3 bg-gray-50 rounded-r-lg">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold text-slate-900">${category.name}</h4>
                            <div class="flex items-center gap-3">
                                <span class="text-sm font-medium ${status.cls}">${status.label}</span>
                                <span class="text-xl font-bold text-hyperlink-blue">${categoryPercentage}%</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600">${categoryDescriptions[category.name] || 'Important factor in determining your business sale readiness.'}</p>
                    </div>
                `;
            });
            
            categoryBreakdownDiv.innerHTML = breakdownHTML;
        }
        
        function setupExitIntent() {
            let exitIntentShown = false;
            
            const showExitIntent = (e) => {
                if (exitIntentShown) return;
                if (e.clientY <= 0) {
                    exitIntentShown = true;
                    if (confirm("Wait! Are you sure you want to leave without getting your complete analysis? This personalized report could help increase your business value significantly.")) {
                        // User confirmed they want to leave
                        return true;
                    } else {
                        // User wants to stay, prevent leaving
                        e.preventDefault();
                        trackEvent('exit_intent_prevented');
                        return false;
                    }
                }
            };
            
            // Add mouseout listener for exit intent
            document.addEventListener('mouseout', showExitIntent);
            
            // Clean up on form submission or when leaving results page
            const cleanup = () => {
                document.removeEventListener('mouseout', showExitIntent);
            };
            
            // Store cleanup function for later use
            window.exitIntentCleanup = cleanup;
        }
        
        function showDetailedReport() {
            // Clean up exit intent when user proceeds to form
            if (window.exitIntentCleanup) {
                window.exitIntentCleanup();
            }
            
            document.getElementById('results').classList.add('hidden');
            document.getElementById('leadCapture').classList.remove('hidden');
            // Carry over CTA copy from the score page
            try {
                const label = window.scoreCTA?.label || 'Get My Report →';
                const sub = window.scoreCTA?.sub || 'See exactly what to fix first to attract premium buyers.';
                const headingEl = document.getElementById('leadHeading');
                const descEl = document.getElementById('leadDesc');
                const btnTextEl = document.getElementById('submitBtnText');
                if (headingEl) headingEl.textContent = label;
                if (descEl) descEl.textContent = sub;
                if (btnTextEl) btnTextEl.textContent = label;
            } catch (_) {}
            
            trackEvent('begin_lead_capture');
            
            // Track form field interactions
            setupFormTracking();
        }
        
        function setupFormTracking() {
            const formFields = ['name', 'email'];
            
            formFields.forEach(fieldName => {
                const field = document.querySelector(`input[name="${fieldName}"]`);
                if (field) {
                    field.addEventListener('focus', () => {
                        trackEvent('form_field_focus', {
                            field_name: fieldName
                        });
                    });
                    
                    field.addEventListener('blur', () => {
                        if (field.validity.valueMissing || !field.validity.valid) {
                            trackEvent('form_validation_error', {
                                field_name: fieldName,
                                error_type: field.validity.valueMissing ? 'required' : 'invalid'
                            });
                        }
                    });
                }
            });
            
            // Set up phone number masking
            setupPhoneMask();
            
            // Set up zip code validation
            setupZipCodeValidation();
            
            // Set up website validation
            setupWebsiteValidation();
        }
        
        function setupPhoneMask() {
            // Apply phone mask to both phone inputs
            const phoneInputs = [document.getElementById('phoneInput'), document.getElementById('phoneInputStep2')];
            
            phoneInputs.forEach(phoneInput => {
                if (!phoneInput) return;
                
                phoneInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, ''); // Remove all non-digits
                    
                    if (value.length >= 6) {
                        // Format as (XXX) XXX-XXXX
                        value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
                    } else if (value.length >= 3) {
                        // Format as (XXX) XXX
                        value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
                    } else if (value.length > 0) {
                        // Format as (XXX
                        value = `(${value}`;
                    }
                    
                    e.target.value = value;
                });
                
                // Handle backspace to remove formatting
                phoneInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace') {
                        let value = e.target.value;
                        // If we're deleting a formatting character, delete the digit before it too
                        if (value.endsWith(') ') || value.endsWith('-')) {
                            e.preventDefault();
                            e.target.value = value.slice(0, -2);
                            // Trigger input event to reformat
                            e.target.dispatchEvent(new Event('input'));
                        }
                    }
                });
                
                // Validation
                phoneInput.addEventListener('blur', function(e) {
                    const value = e.target.value.replace(/\D/g, '');
                    if (value.length !== 10) {
                        e.target.setCustomValidity('Please enter a valid 10-digit US phone number');
                    } else {
                        e.target.setCustomValidity('');
                    }
                });
            });
        }

        // Setup zip code validation
        function setupZipCodeValidation() {
            const zipcodeInput = document.getElementById('zipcodeInput');
            if (!zipcodeInput) return;
            
            // Restrict to numbers only and max 5 digits
            zipcodeInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, ''); // Remove all non-digits
                value = value.slice(0, 5); // Limit to 5 digits
                e.target.value = value;
            });
            
            // Validation on blur
            zipcodeInput.addEventListener('blur', function(e) {
                const value = e.target.value;
                if (value.length !== 5) {
                    e.target.setCustomValidity('Please enter a valid 5-digit ZIP code');
                } else {
                    e.target.setCustomValidity('');
                }
            });
        }

        // Setup website field formatting
        function setupWebsiteValidation() {
            // Apply website validation to both website inputs
            const websiteInputs = [document.getElementById('websiteInput'), document.getElementById('websiteInputStep2')];
            
            websiteInputs.forEach(websiteInput => {
                if (!websiteInput) return;
                
                websiteInput.addEventListener('blur', function(e) {
                    let value = e.target.value.trim();
                    if (value && !value.startsWith('http://') && !value.startsWith('https://')) {
                        // Add https:// if no protocol specified
                        if (value.includes('.') && !value.startsWith('www.')) {
                            e.target.value = 'https://' + value;
                        } else if (value.startsWith('www.')) {
                            e.target.value = 'https://' + value;
                        }
                    }
                });
                
                // Validate URL format
                websiteInput.addEventListener('input', function(e) {
                    const value = e.target.value.trim();
                    if (value) {
                        const urlPattern = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/;
                        const domainPattern = /^[\da-z\.-]+\.([a-z\.]{2,6})$/;
                        
                        if (!urlPattern.test(value) && !domainPattern.test(value)) {
                            e.target.setCustomValidity('Please enter a valid website URL');
                        } else {
                            e.target.setCustomValidity('');
                        }
                    }
                });
            });
        }

        async function submitLeadForm(event) {
            event.preventDefault();
            
            // Show loading state immediately
            showLoadingState();
            
            const formData = new FormData(event.target);
            const timeSpent = assessmentStartTime ? Math.floor((Date.now() - assessmentStartTime) / 1000) : 0;
            
            // Track lead form submit attempt
            try {
                trackEvent('lead_form_submit', {
                    name: formData.get('name') || '',
                    email: formData.get('email') || '',
                    industry: businessInfo?.industry || '',
                    score: parseInt(document.getElementById('scoreValue').textContent) || 0,
                    time_spent: timeSpent
                });
            } catch (e) {}
            
            // Spam protection - honeypot check
            const honeypot = formData.get('honeypot');
            if (honeypot) {
                // Silent fail for spam protection
                hideLoadingState();
                return;
            }
            
            // No reCAPTCHA for now
            
            if (timeSpent < 30) {
                hideLoadingState();
                alert('Please take your time to complete the assessment properly.');
                return;
            }
            
            // Prepare data for Supabase
            const submissionData = {
                name: formData.get('name'),
                email: formData.get('email'),
                company: formData.get('company'),
                phone: formData.get('phone') ? formData.get('phone').replace(/\D/g, '') : null, // Store digits only
                industry: businessInfo.industry,
                website: formData.get('website') || null,
                zipcode: businessInfo.zipcode,
                revenue: businessInfo.revenue,
                revenue_numeric: businessInfo.revenueNumeric,
                employees: businessInfo.employees,
                employees_numeric: businessInfo.employeesNumeric,
                score: parseInt(document.getElementById('scoreValue').textContent),
                responses: answers,
                time_spent: timeSpent,
                user_agent: navigator.userAgent,
                referrer: document.referrer,
                recaptcha_token: null,
                ip_address: null // Will be set by server if needed
            };
            
            try {
                // Track processing start
                const processingStartTime = Date.now();
                trackEvent('processing_started', {
                    assessment_score: parseInt(document.getElementById('scoreValue').textContent)
                });
                
                // Step 2: AI Processing
                setTimeout(() => updateProcessingStep(2), 2000);
                
                // Submit to our secure Netlify function
                const response = await fetch('/.netlify/functions/process-assessment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(submissionData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                // Track processing completion
                const processingTime = Date.now() - processingStartTime;
                trackEvent('processing_completed', {
                    processing_time_ms: processingTime,
                    processing_time_seconds: Math.round(processingTime / 1000)
                });
                
                // Track lead form success
                trackEvent('lead_form_success', {
                    assessment_id: result?.id || null,
                    score: parseInt(document.getElementById('scoreValue').textContent) || 0,
                    industry: businessInfo?.industry || ''
                });
                // Meta Pixel Lead event
                try { trackFBEvent('Lead', { value: 0, currency: 'USD' }); } catch (e) {}
                
                // Step 3: Report preparation
                setTimeout(() => updateProcessingStep(3), 500);
                
                // Track conversion
                trackEvent('generate_lead', {
                    currency: 'USD',
                    value: 100,
                    custom_parameter_1: parseInt(document.getElementById('scoreValue').textContent),
                    custom_parameter_2: businessInfo.industry
                });
                
                trackFBEvent('Lead', {
                    currency: 'USD',
                    value: 100
                });
                
                // Small delay to show final step
                setTimeout(() => {
                    hideLoadingState();
                    // Don't clear progress yet - we have a second form
                    // Show additional details form
                    document.getElementById('leadCapture').classList.add('hidden');
                    document.getElementById('additionalDetails').classList.remove('hidden');
                    
                    // Store the submission result for later use
                    window.submissionResult = result;
                }, 1000);
                
            } catch (error) {
                console.error('Error submitting lead:', error);
                
                // Track processing failure
                trackEvent('processing_failed', {
                    error_message: error.message || 'Unknown error',
                    assessment_score: parseInt(document.getElementById('scoreValue').textContent)
                });
                
                // Track lead form error
                trackEvent('lead_form_error', {
                    error_message: error.message || 'Unknown error'
                });
                
                hideLoadingState();
                showErrorMessage('There was an error submitting your information. Please try again or contact us directly.');
            }
        }
        
        // Additional Details Form Functions
        async function submitAdditionalDetails(event) {
            event.preventDefault();
            
            // Show loading state
            const submitBtn2 = document.getElementById('submitBtn2');
            const submitBtnText2 = document.getElementById('submitBtnText2');
            const submitBtnLoading2 = document.getElementById('submitBtnLoading2');
            
            submitBtn2.disabled = true;
            submitBtn2.classList.add('btn-loading');
            submitBtnText2.classList.add('hidden');
            submitBtnLoading2.classList.remove('hidden');
            
            try {
                const formData = new FormData(event.target);
                
                // Prepare update data
                const updateData = {
                    id: window.submissionResult?.id,
                    company: formData.get('company') || '',
                    phone: formData.get('phone') || '',
                    website: formData.get('website') || '',
                    form_step_completed: 2
                };
                
                // Track additional details submit attempt
                trackEvent('additional_details_submit', {
                    has_phone: !!updateData.phone,
                    has_website: !!updateData.website
                });
                
                // Submit additional details
                const response = await fetch('/.netlify/functions/update-assessment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // Track completion
                trackEvent('additional_details_completed', {
                    has_phone: !!formData.get('phone'),
                    has_website: !!formData.get('website')
                });
                
                trackEvent('additional_details_success', {
                    assessment_id: window.submissionResult?.id || null
                });
                // Meta Pixel Lead event on step 2 as well
                try { trackFBEvent('Lead', { value: 0, currency: 'USD' }); } catch (e) {}
                
                // Show success and move to thank you
                setTimeout(() => {
                    // Clear saved progress now
                    clearProgress();
                    document.getElementById('additionalDetails').classList.add('hidden');
                    document.getElementById('thankYou').classList.remove('hidden');
                }, 500);
                
            } catch (error) {
                console.error('Error updating details:', error);
                // Hide loading and show error
                submitBtn2.disabled = false;
                submitBtn2.classList.remove('btn-loading');
                submitBtnText2.classList.remove('hidden');
                submitBtnLoading2.classList.add('hidden');
                
                const errorElement = document.getElementById('errorMessage2');
                if (errorElement) {
                    errorElement.textContent = 'There was an error updating your information. Please try again.';
                    errorElement.style.display = 'block';
                }
                
                // Track additional details error
                trackEvent('additional_details_error', {
                    error_message: error.message || 'Unknown error'
                });
            }
        }
        
        function skipAdditionalDetails() {
            // Track skip action
            trackEvent('additional_details_skipped');
            
            // Clear saved progress and go to thank you
            clearProgress();
            document.getElementById('additionalDetails').classList.add('hidden');
            document.getElementById('thankYou').classList.remove('hidden');
        }
        
        // Loading state functions
        function showLoadingState() {
            // Disable submit button and show loading
            const submitBtn = document.getElementById('submitBtn');
            const submitBtnText = document.getElementById('submitBtnText');
            const submitBtnLoading = document.getElementById('submitBtnLoading');
            
            submitBtn.disabled = true;
            submitBtn.classList.add('btn-loading');
            submitBtnText.classList.add('hidden');
            submitBtnLoading.classList.remove('hidden');
            
            // Show processing overlay
            document.getElementById('processingOverlay').classList.remove('hidden');
            
            // Reset all steps
            resetProcessingSteps();
        }
        
        function hideLoadingState() {
            // Re-enable submit button
            const submitBtn = document.getElementById('submitBtn');
            const submitBtnText = document.getElementById('submitBtnText');
            const submitBtnLoading = document.getElementById('submitBtnLoading');
            
            submitBtn.disabled = false;
            submitBtn.classList.remove('btn-loading');
            submitBtnText.classList.remove('hidden');
            submitBtnLoading.classList.add('hidden');
            
            // Hide processing overlay
            document.getElementById('processingOverlay').classList.add('hidden');
        }
        
        // Message functions for better UX
        function showErrorMessage(message) {
            const errorElement = document.getElementById('errorMessage');
            const successElement = document.getElementById('successMessage');
            
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                errorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            if (successElement) {
                successElement.style.display = 'none';
            }
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            }, 10000);
        }
        
        function showSuccessMessage(message) {
            const errorElement = document.getElementById('errorMessage');
            const successElement = document.getElementById('successMessage');
            
            if (successElement) {
                successElement.textContent = message;
                successElement.style.display = 'block';
                successElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        }
        
        function resetProcessingSteps() {
            // Reset to step 1 active
            document.getElementById('step1').classList.remove('opacity-50');
            document.getElementById('step1').querySelector('.w-2').classList.remove('bg-gray-300');
            document.getElementById('step1').querySelector('.w-2').classList.add('bg-green-500');
            
            document.getElementById('step2').classList.add('opacity-50');
            document.getElementById('step2').querySelector('.w-2').classList.add('bg-gray-300');
            document.getElementById('step2').querySelector('.w-2').classList.remove('bg-green-500');
            
            document.getElementById('step3').classList.add('opacity-50');
            document.getElementById('step3').querySelector('.w-2').classList.add('bg-gray-300');
            document.getElementById('step3').querySelector('.w-2').classList.remove('bg-green-500');
        }

        // Print helper: show results in print-friendly view
        function printReport() {
            try {
                trackEvent('print_report', {
                    score: parseInt(document.getElementById('scoreValue')?.textContent || '0') || 0,
                    industry: businessInfo?.industry || ''
                });
            } catch (_) {}
            // Ensure results are visible before printing
            try { document.getElementById('results').classList.remove('hidden'); } catch(_){}
            window.print();
        }

        function updateProcessingStep(step) {
            if (step === 2) {
                document.getElementById('step2').classList.remove('opacity-50');
                document.getElementById('step2').querySelector('.w-2').classList.remove('bg-gray-300');
                document.getElementById('step2').querySelector('.w-2').classList.add('bg-green-500');
            } else if (step === 3) {
                document.getElementById('step3').classList.remove('opacity-50');
                document.getElementById('step3').querySelector('.w-2').classList.remove('bg-gray-300');
                document.getElementById('step3').querySelector('.w-2').classList.add('bg-green-500');
            }
        }
        
        // Progress saving and restoration
        function saveProgress() {
            const progress = {
                currentCategoryIndex,
                currentQuestionIndex,
                answers,
                businessInfo,
                assessmentStartTime,
                currentQuestionNumber,
                timestamp: Date.now()
            };
            
            try {
                sessionStorage.setItem('assessmentProgress', JSON.stringify(progress));
            } catch (error) {
                // Silently fail if sessionStorage is not available
            }
        }
        
        function restoreProgress() {
            try {
                const savedProgress = sessionStorage.getItem('assessmentProgress');
                if (!savedProgress) return;
                
                const progress = JSON.parse(savedProgress);
                
                // Check if progress is recent (within 24 hours)
                const hoursSinceLastSave = (Date.now() - progress.timestamp) / (1000 * 60 * 60);
                if (hoursSinceLastSave > 24) {
                    clearProgress();
                    return;
                }
                
                // Restore state (indices may be stale across deploys; recompute from answers length)
                currentCategoryIndex = 0;
                currentQuestionIndex = 0;
                answers = progress.answers || [];
                businessInfo = progress.businessInfo || {};
                assessmentStartTime = progress.assessmentStartTime || null;
                currentQuestionNumber = progress.currentQuestionNumber || 0;

                // Ensure indices align with answers count and current question structure
                try {
                    let answered = Array.isArray(answers) ? answers.length : 0;
                    for (let i = 0; i < categories.length; i++) {
                        const len = categories[i].questions.length;
                        if (answered > len) {
                            answered -= len;
                            continue;
                        }
                        currentCategoryIndex = i;
                        currentQuestionIndex = Math.max(0, Math.min(answered, len - 1));
                        break;
                    }
                    if (answers.length >= totalQuestions) {
                        currentCategoryIndex = categories.length - 1;
                        currentQuestionIndex = categories[categories.length - 1].questions.length - 1;
                    }
                } catch (_) { /* keep defaults */ }
                
                // Show restoration notification and continue from saved point
                if (answers.length > 0 || Object.keys(businessInfo).length > 0) {
                    // Track progress restoration
                    trackEvent('progress_restored', {
                        answers_restored: answers.length,
                        time_since_save: Math.round(hoursSinceLastSave * 60), // minutes
                        business_info_complete: !!(businessInfo.industry && businessInfo.revenue && businessInfo.employees)
                    });
                    
                    showRestorationNotification();
                    
                    // Restore industry selection if available
                    if (businessInfo.industry) {
                        document.getElementById('industry').value = businessInfo.industry;
                    }
                    
                    // If all questions were already answered previously, show results immediately
                    if (businessInfo.employees && answers.length >= totalQuestions) {
                        document.getElementById('welcome').classList.add('hidden');
                        calculateResults();
                        return;
                    }

                    // Resume from the appropriate screen
                    if (businessInfo.industry && !businessInfo.revenue) {
                        document.getElementById('welcome').classList.add('hidden');
                        showScreen('revenueSelection');
                        document.getElementById('progressBar').style.width = '25%';
                    } else if (businessInfo.revenue && !businessInfo.employees) {
                        document.getElementById('welcome').classList.add('hidden');
                        showScreen('employeeSelection');
                        document.getElementById('progressBar').style.width = '50%';
                    } else if (businessInfo.employees && answers.length < totalQuestions) {
                        document.getElementById('welcome').classList.add('hidden');
                        showQuestion();
                    }
                    
                    // Update progress bar
                    updateProgress();
                }
            } catch (error) {
                // If there's an error, clear the corrupted progress
                clearProgress();
            }
        }
        
        function clearProgress() {
            try {
                sessionStorage.removeItem('assessmentProgress');
            } catch (error) {
                // Silently fail if sessionStorage is not available
            }
        }
        
        function showRestorationNotification() {
            // Create a temporary notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-100 border border-green-300 text-green-800 px-4 py-3 rounded-lg shadow-lg z-50 max-w-sm';
            notification.innerHTML = `
                <div class="flex items-start">
                    <svg class="w-5 h-5 mr-2 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div class="flex-1">
                        <div class="font-medium">Progress Restored</div>
                        <div class="text-sm mb-2">Continuing from where you left off</div>
                        <button onclick="startOver()" class="text-xs underline hover:no-underline">Start over instead</button>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-green-600 hover:text-green-800">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 8 seconds (longer since there's a start over option)
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 8000);
        }
        
        function startOver() {
            // Track fresh start choice
            trackEvent('fresh_start_chosen', {
                previous_answers: answers.length,
                previous_business_info: Object.keys(businessInfo).length
            });
            
            // Clear progress and reload page
            clearProgress();
            window.location.reload();
        }
    </script>

    <!-- Footer -->
    <footer class="bg-dark-anchor text-white py-12 mt-16">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-12 items-start">
                <!-- Company Info (wider column) -->
                <div class="md:col-span-3">
                    <h2 class="text-4xl font-medium text-white mb-4 font-headline">Arx Brokers</h2>
                    <p class="text-sm text-bright-white leading-relaxed font-body max-w-md">
                        Arx Brokers is a sell-side business brokerage and mergers and acquisitions advisory firm for business owners with $1M - $25M in sales or more than $300k in EBITDA.
                    </p>
                </div>
                
                <!-- Headquarters -->
                <div class="md:ml-4">
                    <h3 class="text-lg font-medium text-white mb-4 font-headline">Headquarters</h3>
                    <div class="text-sm text-cool-gray font-body">
                        <p>2900 NW Clearwater Dr.</p>
                        <p>Bend, OR 97703</p>
                    </div>
                </div>
                
                <!-- Contact -->
                <div>
                    <h3 class="text-lg font-medium text-white mb-4 font-headline">Contact</h3>
                    <div class="text-sm text-cool-gray font-body">
                        <p><a href="mailto:sales@arxbrokers.com" class="hover:text-white transition-colors underline">sales@arxbrokers.com</a></p>
                        <p><a href="tel:8558582130" class="hover:text-white transition-colors underline">(855) 858-2130</a></p>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Section -->
            <div class="mt-12 pt-6">
                <div class="text-left">
                    <a href="https://arxbrokers.com/privacy" class="text-sm text-cool-gray hover:text-white transition-colors underline font-body">Privacy Policy</a>
                </div>
            </div>
        </div>
    </footer>

</body>
</html>
